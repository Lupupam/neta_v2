<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>NETWORK ATTACKS FRAMEWORK: NA_aodv_uu_omnet.cc Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">NETWORK ATTACKS FRAMEWORK
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A NETwork Attacks framework. Making network attacks impact evaluation easier!</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('NA__aodv__uu__omnet_8cc.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">NA_aodv_uu_omnet.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="NA__aodv__uu__omnet_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (C) 2002 Uppsala University.</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 2006 Malaga University.</span>
<a name="l00005"></a>00005 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00007"></a>00007 <span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00008"></a>00008 <span class="comment"> * (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00017"></a>00017 <span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * Authors: Bj�n Wiberg &lt;bjorn.wiberg@home.se&gt;</span>
<a name="l00020"></a>00020 <span class="comment"> *          Erik Nordstr� &lt;erik.nordstrom@it.uu.se&gt;</span>
<a name="l00021"></a>00021 <span class="comment"> * Authors: Alfonso Ariza Quintana.&lt;aarizaq@uma.ea&gt;</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> *****************************************************************************/</span>
<a name="l00024"></a>00024 <span class="comment">//</span>
<a name="l00025"></a>00025 <span class="comment">// Copyright (C) 2013 and modified by NESG (Network Engineering and Security Group), http://nesg.ugr.es,</span>
<a name="l00026"></a>00026 <span class="comment">// - Gabriel Maciá Fernández (gmacia@ugr.es)</span>
<a name="l00027"></a>00027 <span class="comment">// - Leovigildo Sánchez Casado (sancale@ugr.es)</span>
<a name="l00028"></a>00028 <span class="comment">// - Rafael A. Rodríguez Gómez (rodgom@ugr.es)</span>
<a name="l00029"></a>00029 <span class="comment">// - Roberto Magán Carrión (rmagan@ugr.es)</span>
<a name="l00030"></a>00030 <span class="comment">// - Pedro García Teodoro (pgteodor@ugr.es)</span>
<a name="l00031"></a>00031 <span class="comment">// - José Camacho Páez (josecamacho@ugr.es)</span>
<a name="l00032"></a>00032 <span class="comment">// - Jesús E. Díaz Verdejo (jedv@ugr.es)</span>
<a name="l00033"></a>00033 <span class="comment">//</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="NA__aodv__uu__omnet_8h.html">NA_aodv_uu_omnet.h</a>&quot;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;UDPPacket.h&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;IPv4ControlInfo.h&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;IPv6ControlInfo.h&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;ICMPMessage_m.h&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;ICMPAccess.h&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;NotifierConsts.h&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;IPv4Datagram.h&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;IPv4InterfaceData.h&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;ProtocolMap.h&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;IPv4Address.h&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;IPvXAddress.h&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;ControlManetRouting_m.h&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;Ieee802Ctrl_m.h&quot;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#aef334ff0aa0d9bd45ea8385f98a49805">00055</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="NA__aodv__uu__omnet_8cc.html#aef334ff0aa0d9bd45ea8385f98a49805">UDP_HEADER_BYTES</a> = 8;
<a name="l00056"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#abb3820de782b5197e0695186ca4462cd">00056</a> <span class="keyword">typedef</span> std::vector&lt;IPv4Address&gt; <a class="code" href="NA__aodv__uu__omnet_8cc.html#abb3820de782b5197e0695186ca4462cd">IPAddressVector</a>;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <a class="code" href="NA__DelayAttack_8cc.html#a676ad33d9b6679086b4430571b4321c2">Define_Module</a>(<a class="code" href="classNA__AODVUU.html" title="ADOVUU hacked module.">NA_AODVUU</a>);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">/* Constructor for the AODVUU routing agent */</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="keywordtype">bool</span> <a class="code" href="classNA__AODVUU.html#a863ecc8c7f3d3fd3c36bb6a782653a9f">NA_AODVUU::log_file_fd_init</a>=<span class="keyword">false</span>;
<a name="l00063"></a>00063 <span class="keywordtype">int</span> <a class="code" href="classNA__AODVUU.html#ae9f5bb739cbf1923c5fe7d6389dfade2">NA_AODVUU::log_file_fd</a> = -1;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="preprocessor">#ifdef AODV_GLOBAL_STATISTISTIC</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="keywordtype">bool</span> <a class="code" href="classNA__AODVUU.html#a86056968c6425ceec38a5dec9c6ea03c">NA_AODVUU::iswrite</a> = <span class="keyword">false</span>;
<a name="l00067"></a>00067 <span class="keywordtype">int</span> <a class="code" href="classNA__AODVUU.html#aa8596f27fddd91329b663d54553a7e66">NA_AODVUU::totalSend</a>=0;
<a name="l00068"></a>00068 <span class="keywordtype">int</span> <a class="code" href="classNA__AODVUU.html#ac4beddf8a5000b991652e786040019d8">NA_AODVUU::totalRreqSend</a>=0;
<a name="l00069"></a>00069 <span class="keywordtype">int</span> <a class="code" href="classNA__AODVUU.html#a87bff842f022887c555cb72ef0240e59">NA_AODVUU::totalRreqRec</a>=0;
<a name="l00070"></a>00070 <span class="keywordtype">int</span> <a class="code" href="classNA__AODVUU.html#a0af1c086b13903ba526394e47f711273">NA_AODVUU::totalRrepSend</a>=0;
<a name="l00071"></a>00071 <span class="keywordtype">int</span> <a class="code" href="classNA__AODVUU.html#a113e95772c140ad9674171bb72d5d7d5">NA_AODVUU::totalRrepRec</a>=0;
<a name="l00072"></a>00072 <span class="keywordtype">int</span> <a class="code" href="classNA__AODVUU.html#a603c520e71e6be80e9e4136e2a6f05d3">NA_AODVUU::totalRrepAckSend</a>=0;
<a name="l00073"></a>00073 <span class="keywordtype">int</span> <a class="code" href="classNA__AODVUU.html#ad68f739c42338512a4dad4d7ac04b04c">NA_AODVUU::totalRrepAckRec</a>=0;
<a name="l00074"></a>00074 <span class="keywordtype">int</span> <a class="code" href="classNA__AODVUU.html#a08ea2c9f3a6f83458982d5beb8f2dea8">NA_AODVUU::totalRerrSend</a>=0;
<a name="l00075"></a>00075 <span class="keywordtype">int</span> <a class="code" href="classNA__AODVUU.html#ab3372581e806d3be467c979526f6b50a">NA_AODVUU::totalRerrRec</a>=0;
<a name="l00076"></a>00076 <span class="preprocessor">#endif</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span>
<a name="l00078"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a5dce0c1a52d0def1b8c00036194ee853">00078</a> <span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a5dce0c1a52d0def1b8c00036194ee853">initialize</a>(<span class="keywordtype">int</span> stage)
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080      <span class="comment">/*</span>
<a name="l00081"></a>00081 <span class="comment">       Enable usage of some of the configuration variables from Tcl.</span>
<a name="l00082"></a>00082 <span class="comment"></span>
<a name="l00083"></a>00083 <span class="comment">       Note: Do NOT change the values of these variables in the constructor</span>
<a name="l00084"></a>00084 <span class="comment">       after binding them! The desired default values should be set in</span>
<a name="l00085"></a>00085 <span class="comment">       ~ns/tcl/lib/ns-default.tcl instead.</span>
<a name="l00086"></a>00086 <span class="comment">     */</span>
<a name="l00087"></a>00087     <span class="keywordflow">if</span> (stage==4)
<a name="l00088"></a>00088     {
<a name="l00089"></a>00089 <span class="preprocessor">#ifndef AODV_GLOBAL_STATISTISTIC</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>        iswrite = <span class="keyword">false</span>;
<a name="l00091"></a>00091         totalSend=0;
<a name="l00092"></a>00092         totalRreqSend=0;
<a name="l00093"></a>00093         totalRreqRec=0;
<a name="l00094"></a>00094         totalRrepSend=0;
<a name="l00095"></a>00095         totalRrepRec=0;
<a name="l00096"></a>00096         totalRrepAckSend=0;
<a name="l00097"></a>00097         totalRrepAckRec=0;
<a name="l00098"></a>00098         totalRerrSend=0;
<a name="l00099"></a>00099         totalRerrRec=0;
<a name="l00100"></a>00100 <span class="preprocessor">#endif</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span>        <a class="code" href="main_8c.html#afa6334ccb70fdb244e4ac3f256241bca">log_to_file</a> = 0;
<a name="l00102"></a>00102         <a class="code" href="main_8c.html#a5195b41adb4586d2ad897d08ebb3dfad">hello_jittering</a> = 0;
<a name="l00103"></a>00103         <a class="code" href="main_8c.html#aff2e4196aa2a66f42a9688b5dde5cbd8">optimized_hellos</a> = 0;
<a name="l00104"></a>00104         <a class="code" href="main_8c.html#a09464654a5c100dc4840caefec4672b0">expanding_ring_search</a> = 0;
<a name="l00105"></a>00105         <a class="code" href="main_8c.html#ab289d12fed7e29d1431a3206d813170c">local_repair</a> = 0;
<a name="l00106"></a>00106         <a class="code" href="NA__debug__aodv_8h.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>=0;
<a name="l00107"></a>00107         <a class="code" href="main_8c.html#a9114356a8b6ad57f39c4d50388776531">rreq_gratuitous</a> =0;
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         <span class="comment">// BEGIN NA_SINKHOLE - sancale</span>
<a name="l00110"></a>00110         <span class="comment">// Sinkhole attack initialization</span>
<a name="l00111"></a>00111         sinkholeAttackIsActive = <span class="keyword">false</span>;
<a name="l00112"></a>00112         sinkholeAttackProbability = 0;
<a name="l00113"></a>00113         sinkOnlyWhenRouteInTable = <span class="keyword">false</span>;
<a name="l00114"></a>00114         numSents = 0;
<a name="l00115"></a>00115         <span class="comment">// END NA_SINKHOLE - sancale</span>
<a name="l00116"></a>00116 
<a name="l00117"></a>00117         <span class="comment">//sendMessageEvent = new cMessage();</span>
<a name="l00118"></a>00118         <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>)par(<span class="stringliteral">&quot;log_to_file&quot;</span>))
<a name="l00119"></a>00119             <a class="code" href="main_8c.html#afa6334ccb70fdb244e4ac3f256241bca">log_to_file</a> = 1;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121         <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>) par(<span class="stringliteral">&quot;hello_jittering&quot;</span>))
<a name="l00122"></a>00122             <a class="code" href="main_8c.html#a5195b41adb4586d2ad897d08ebb3dfad">hello_jittering</a> = 1;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124         <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>)par(<span class="stringliteral">&quot;optimized_hellos&quot;</span>))
<a name="l00125"></a>00125             <a class="code" href="main_8c.html#aff2e4196aa2a66f42a9688b5dde5cbd8">optimized_hellos</a>  = 1;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>)par(<span class="stringliteral">&quot;expanding_ring_search&quot;</span>))
<a name="l00128"></a>00128             <a class="code" href="main_8c.html#a09464654a5c100dc4840caefec4672b0">expanding_ring_search</a> = 1;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>) par(<span class="stringliteral">&quot;local_repair&quot;</span>))
<a name="l00131"></a>00131             <a class="code" href="main_8c.html#ab289d12fed7e29d1431a3206d813170c">local_repair</a> = 1;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>)par(<span class="stringliteral">&quot;rreq_gratuitous&quot;</span>))
<a name="l00134"></a>00134             <a class="code" href="main_8c.html#a9114356a8b6ad57f39c4d50388776531">rreq_gratuitous</a> = 1;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136         <span class="keywordflow">if</span> ((<span class="keywordtype">bool</span>)par(<span class="stringliteral">&quot;debug&quot;</span>))
<a name="l00137"></a>00137             <a class="code" href="NA__debug__aodv_8h.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> = 1;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         useIndex = par(<span class="stringliteral">&quot;UseIndex&quot;</span>);
<a name="l00140"></a>00140         <a class="code" href="main_8c.html#ae55eec632e369a4afc18e804bae8f3e4">unidir_hack</a> = (int) par(<span class="stringliteral">&quot;unidir_hack&quot;</span>);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142         <a class="code" href="main_8c.html#aa10c5b3c1ff250cd241fe589fdf92253">receive_n_hellos</a>    = (int) par(<span class="stringliteral">&quot;receive_n_hellos&quot;</span>);
<a name="l00143"></a>00143         <a class="code" href="main_8c.html#ae9b50005184bab60e94309c7a30c5c85">wait_on_reboot</a> = (int) par (<span class="stringliteral">&quot;wait_on_reboot&quot;</span>);
<a name="l00144"></a>00144         <a class="code" href="main_8c.html#a10b915edc92aec7ca4584b10aacdb7e7">rt_log_interval</a> = (int) par(<span class="stringliteral">&quot;rt_log_interval&quot;</span>); <span class="comment">// Note: in milliseconds!</span>
<a name="l00145"></a>00145         <a class="code" href="main_8c.html#a3ecfcf4b066b9c242e176393695e38d0">ratelimit</a> = (int) par(<span class="stringliteral">&quot;ratelimit&quot;</span>);
<a name="l00146"></a>00146         <a class="code" href="main_8c.html#a20ce58c799d3953a9d57e6c3f8910633">llfeedback</a> = 0;
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (par(<span class="stringliteral">&quot;llfeedback&quot;</span>))
<a name="l00148"></a>00148             <a class="code" href="main_8c.html#a20ce58c799d3953a9d57e6c3f8910633">llfeedback</a> = 1;
<a name="l00149"></a>00149         <a class="code" href="main_8c.html#a6be52079b3b26f9986ccdddfbca964e6">internet_gw_mode</a> = (int) par(<span class="stringliteral">&quot;internet_gw_mode&quot;</span>);
<a name="l00150"></a>00150         gateWayAddress = <span class="keyword">new</span> IPv4Address(par(<span class="stringliteral">&quot;internet_gw_address&quot;</span>).stringValue());
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a20ce58c799d3953a9d57e6c3f8910633">llfeedback</a>)
<a name="l00153"></a>00153         {
<a name="l00154"></a>00154             <a class="code" href="main_8c.html#a1b01d3369a884952b1b133647b6f8972">active_route_timeout</a> = <a class="code" href="NA__params_8h.html#a42ed2e9e7d24d26a1d0092373d4de678">ACTIVE_ROUTE_TIMEOUT_LLF</a>;
<a name="l00155"></a>00155             <a class="code" href="main_8c.html#ab0e1b854de69ed4c072e72f977599c95">ttl_start</a> = <a class="code" href="NA__params_8h.html#adbe0e5532d6a779e20789e312cf36ddf">TTL_START_LLF</a>;
<a name="l00156"></a>00156             <a class="code" href="main_8c.html#ab2f352af0fd66527b61319af50f5f50a">delete_period</a> =  <a class="code" href="NA__params_8h.html#a57180018d38784864259f54f62713a56">DELETE_PERIOD_LLF</a>;
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158         <span class="keywordflow">else</span>
<a name="l00159"></a>00159         {
<a name="l00160"></a>00160             <a class="code" href="main_8c.html#a1b01d3369a884952b1b133647b6f8972">active_route_timeout</a> = (int) par(<span class="stringliteral">&quot;active_timeout&quot;</span>);<span class="comment">// ACTIVE_ROUTE_TIMEOUT_HELLO;</span>
<a name="l00161"></a>00161             <a class="code" href="main_8c.html#ab0e1b854de69ed4c072e72f977599c95">ttl_start</a> = <a class="code" href="NA__params_8h.html#a85895a7aa8febd51e264593000ed7c4c">TTL_START_HELLO</a>;
<a name="l00162"></a>00162             <a class="code" href="main_8c.html#ab2f352af0fd66527b61319af50f5f50a">delete_period</a> = <a class="code" href="NA__params_8h.html#ac9cc85aa90ba4bc5a62071f6fdd31d5a">DELETE_PERIOD_HELLO</a>;
<a name="l00163"></a>00163         }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="comment">/* Initialize common manet routing protocol structures */</span>
<a name="l00166"></a>00166         registerRoutingModule();
<a name="l00167"></a>00167         <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a20ce58c799d3953a9d57e6c3f8910633">llfeedback</a>)
<a name="l00168"></a>00168             linkLayerFeeback();
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         <span class="comment">/* From main.c */</span>
<a name="l00171"></a>00171         <a class="code" href="main_8c.html#ab9e1449fd00c98428516f0b41eddcb10">progname</a> = strdup(<span class="stringliteral">&quot;AODV-UU&quot;</span>);
<a name="l00172"></a>00172         <span class="comment">/* From debug.c */</span>
<a name="l00173"></a>00173         <span class="comment">/* Note: log_nmsgs was never used anywhere */</span>
<a name="l00174"></a>00174         log_nmsgs = 0;
<a name="l00175"></a>00175         log_rt_fd = -1;
<a name="l00176"></a>00176 <span class="preprocessor">#ifndef  _WIN32</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>
<a name="l00178"></a>00178         <span class="keywordflow">if</span> (<a class="code" href="NA__debug__aodv_8h.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> &amp;&amp; !log_file_fd_init)
<a name="l00179"></a>00179         {
<a name="l00180"></a>00180             log_file_fd = -1;
<a name="l00181"></a>00181             openlog(<span class="stringliteral">&quot;aodv-uu &quot;</span>,0,LOG_USER);
<a name="l00182"></a>00182             <a class="code" href="NA__debug__aodv_8cc.html#aecfc084a466c1e43aa3fc757e1ba3818">log_init</a>();
<a name="l00183"></a>00183             log_file_fd_init=<span class="keyword">true</span>;
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185 <span class="preprocessor">#else</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span>        <a class="code" href="NA__debug__aodv_8h.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> = 0;
<a name="l00187"></a>00187 <span class="preprocessor">#endif</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>        <span class="comment">/* Set host parameters */</span>
<a name="l00189"></a>00189         memset(&amp;<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structhost__info.html">host_info</a>));
<a name="l00190"></a>00190         memset(<a class="code" href="NA__defs__aodv_8h.html#aadc3440bff34bbc102e29a41aa256e18">dev_indices</a>, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) * <a class="code" href="NA__defs__aodv_8h.html#a995d79de9a32d682e10323e736e94505">MAX_NR_INTERFACES</a>);
<a name="l00191"></a>00191         <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a42c045dee154a8fd24c7081602aff457">seqno</a> = 1;
<a name="l00192"></a>00192         <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#ad7cd479f367ded9d8884f1f8c8dd5f02">rreq_id</a> = 0;
<a name="l00193"></a>00193         <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#aac008fcec2a6f263cdb7a328a1677a62">nif</a> = 1;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="NA__defs__aodv_8h.html#a995d79de9a32d682e10323e736e94505">MAX_NR_INTERFACES</a>; i++)
<a name="l00197"></a>00197             <a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).enabled=0;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;getNumInterfaces(); i++)
<a name="l00200"></a>00200         {
<a name="l00201"></a>00201             <a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).ifindex = i;
<a name="l00202"></a>00202             <a class="code" href="NA__defs__aodv_8h.html#aadc3440bff34bbc102e29a41aa256e18">dev_indices</a>[i] = i;
<a name="l00203"></a>00203             strcpy(<a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).ifname, getInterfaceEntry(i)-&gt;<a class="code" href="utilidades_8cc.html#af5b5c4787ffe48b5c4fc01aea42cd1c4">getName</a>());
<a name="l00204"></a>00204             <span class="keywordflow">if</span> (!isInMacLayer())
<a name="l00205"></a>00205             {
<a name="l00206"></a>00206                 <a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).netmask.s_addr =
<a name="l00207"></a>00207                     ManetAddress(getInterfaceEntry(i)-&gt;ipv4Data()-&gt;getIPAddress().getNetworkMask());
<a name="l00208"></a>00208                 <a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).ipaddr.s_addr =
<a name="l00209"></a>00209                         ManetAddress(getInterfaceEntry(i)-&gt;ipv4Data()-&gt;getIPAddress());
<a name="l00210"></a>00210             }
<a name="l00211"></a>00211             <span class="keywordflow">else</span>
<a name="l00212"></a>00212             {
<a name="l00213"></a>00213                 <a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).netmask.s_addr = ManetAddress(MACAddress::BROADCAST_ADDRESS);
<a name="l00214"></a>00214                 <a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(i).ipaddr.s_addr = ManetAddress(getInterfaceEntry(i)-&gt;getMacAddress());
<a name="l00215"></a>00215 
<a name="l00216"></a>00216             }
<a name="l00217"></a>00217         }
<a name="l00218"></a>00218         <span class="comment">/* Set network interface parameters */</span>
<a name="l00219"></a>00219         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; getNumWlanInterfaces(); i++)
<a name="l00220"></a>00220         {
<a name="l00221"></a>00221             <a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(getWlanInterfaceIndex(i)).enabled = 1;
<a name="l00222"></a>00222             <a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(getWlanInterfaceIndex(i)).sock = -1;
<a name="l00223"></a>00223             <a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(getWlanInterfaceIndex(i)).broadcast.s_addr = ManetAddress(IPv4Address(<a class="code" href="NA__defs__aodv_8h.html#a3f5378171d85f4d025988d72cb9eab3c">AODV_BROADCAST</a>));
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226         NS_DEV_NR = getWlanInterfaceIndexByAddress();
<a name="l00227"></a>00227         NS_IFINDEX = getWlanInterfaceIndexByAddress();
<a name="l00228"></a>00228 <span class="preprocessor">#ifndef AODV_USE_STL</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span>        <a class="code" href="structlist__t.html">list_t</a> *lista_ptr;
<a name="l00230"></a>00230         lista_ptr=&amp;rreq_records;
<a name="l00231"></a>00231         <a class="code" href="NA__list_8h.html#a751e0595c81c7eb920acb6bf18960e75">INIT_LIST_HEAD</a>(&amp;rreq_records);
<a name="l00232"></a>00232         lista_ptr=&amp;rreq_blacklist;
<a name="l00233"></a>00233         <a class="code" href="NA__list_8h.html#a751e0595c81c7eb920acb6bf18960e75">INIT_LIST_HEAD</a>(&amp;rreq_blacklist);
<a name="l00234"></a>00234         lista_ptr=&amp;seekhead;
<a name="l00235"></a>00235         <a class="code" href="NA__list_8h.html#a751e0595c81c7eb920acb6bf18960e75">INIT_LIST_HEAD</a>(&amp;seekhead);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237         lista_ptr=&amp;TQ;
<a name="l00238"></a>00238         <a class="code" href="NA__list_8h.html#a751e0595c81c7eb920acb6bf18960e75">INIT_LIST_HEAD</a>(&amp;TQ);
<a name="l00239"></a>00239 <span class="preprocessor">#endif</span>
<a name="l00240"></a>00240 <span class="preprocessor"></span>        <span class="comment">/* Initialize data structures */</span>
<a name="l00241"></a>00241         <a class="code" href="main_8c.html#a102638bbe37dfc0788ddc7de6afbffe5">worb_timer</a>.<a class="code" href="structtimer.html#a63c6ec909c89f16deb5580f74a29d981">data</a> = NULL;
<a name="l00242"></a>00242         <a class="code" href="main_8c.html#a102638bbe37dfc0788ddc7de6afbffe5">worb_timer</a>.<a class="code" href="structtimer.html#aae497dabc6a07ecae336dd90c8c3aa0e">used</a> = 0;
<a name="l00243"></a>00243         hello_timer.data = NULL;
<a name="l00244"></a>00244         hello_timer.used = 0;
<a name="l00245"></a>00245         rt_log_timer.data = NULL;
<a name="l00246"></a>00246         rt_log_timer.used = 0;
<a name="l00247"></a>00247         isRoot = par(<span class="stringliteral">&quot;isRoot&quot;</span>);
<a name="l00248"></a>00248         costStatic = par(<span class="stringliteral">&quot;costStatic&quot;</span>);
<a name="l00249"></a>00249         costMobile = par(<span class="stringliteral">&quot;costMobile&quot;</span>);
<a name="l00250"></a>00250         useHover = par(<span class="stringliteral">&quot;useHover&quot;</span>);
<a name="l00251"></a>00251         proactive_rreq_timeout= par(<span class="stringliteral">&quot;proactiveRreqTimeout&quot;</span>).longValue();
<a name="l00252"></a>00252 
<a name="l00253"></a>00253         <span class="keywordflow">if</span> (isRoot)
<a name="l00254"></a>00254         {
<a name="l00255"></a>00255             <a class="code" href="NA__timer__queue__aodv_8cc.html#a721feeb3bf29621e58f8914c0d5365c0">timer_init</a>(&amp;proactive_rreq_timer,&amp;<a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__rreq_8cc.html#aefb850efc65ffce9a0286d511830d3e9">rreq_proactive</a>, NULL);
<a name="l00256"></a>00256             <a class="code" href="NA__timer__queue__aodv_8cc.html#ace41c2dc22720e5daac03344ac0a4102">timer_set_timeout</a>(&amp;proactive_rreq_timer, proactive_rreq_timeout);
<a name="l00257"></a>00257         }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         propagateProactive = par(<span class="stringliteral">&quot;propagateProactive&quot;</span>);
<a name="l00260"></a>00260         strcpy(nodeName,getParentModule()-&gt;getParentModule()-&gt;<a class="code" href="utilidades_8cc.html#aec3361ebcbcb1526f2f0fff6187169f0">getFullName</a>());
<a name="l00261"></a>00261         <a class="code" href="NA__aodv__socket_8cc.html#a46b63fe67cacd677eb832c40f1466dc0">aodv_socket_init</a>();
<a name="l00262"></a>00262         <a class="code" href="NA__routing__table_8cc.html#af55d0c061f4060fa7df11209b4b0fdbf">rt_table_init</a>();
<a name="l00263"></a>00263         <a class="code" href="NA__packet__queue__omnet_8cc.html#ae755aa26d7987f288c1ae6763d66f5f4">packet_queue_init</a>();
<a name="l00264"></a>00264         <a class="code" href="NA__aodv__uu__omnet_8cc.html#ac2022163ffdaa951d130a0aba7881552">startAODVUUAgent</a>();
<a name="l00265"></a>00265 
<a name="l00266"></a>00266         is_init=<span class="keyword">true</span>;
<a name="l00267"></a>00267         <span class="comment">// Initialize the timer</span>
<a name="l00268"></a>00268         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00269"></a>00269         ev &lt;&lt; <span class="stringliteral">&quot;Aodv active&quot;</span>&lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00270"></a>00270     }
<a name="l00271"></a>00271 }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 <span class="comment">/* Destructor for the AODV-UU routing agent */</span>
<a name="l00274"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#ac64c0a26a140522ebd7d60272535e71f">00274</a> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#ac64c0a26a140522ebd7d60272535e71f">~ NA_AODVUU</a>()
<a name="l00275"></a>00275 {
<a name="l00276"></a>00276     <a class="code" href="structlist__t.html">list_t</a> *tmp = NULL, *pos = NULL;
<a name="l00277"></a>00277 <span class="preprocessor">#ifdef AODV_USE_STL_RT</span>
<a name="l00278"></a>00278 <span class="preprocessor"></span>    <span class="keywordflow">while</span> (!aodvRtTableMap.empty())
<a name="l00279"></a>00279     {
<a name="l00280"></a>00280         free (aodvRtTableMap.begin()-&gt;second);
<a name="l00281"></a>00281         aodvRtTableMap.erase(aodvRtTableMap.begin());
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 <span class="preprocessor">#else</span>
<a name="l00284"></a>00284 <span class="preprocessor"></span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="NA__routing__table_8h.html#a372eb877536fc42dec7273e7e5682589">RT_TABLESIZE</a>; i++)
<a name="l00285"></a>00285     {
<a name="l00286"></a>00286         <a class="code" href="NA__list_8h.html#af15e2de3344d7da69bb2620b6f92a879">list_foreach_safe</a>(pos, tmp, &amp;<a class="code" href="NA__routing__table_8h.html#a56f12e70a7c6b6382f18390882a4efa3">rt_tbl</a>.<a class="code" href="structrouting__table.html#a9342dc0960c9521d5fdd827890d3c31f">tbl</a>[i])
<a name="l00287"></a>00287         {
<a name="l00288"></a>00288             <a class="code" href="structrt__table.html">rt_table_t</a> *rt = (<a class="code" href="structrt__table.html">rt_table_t</a> *) pos;
<a name="l00289"></a>00289             <a class="code" href="NA__list_8cc.html#a95fe3a213ff2c475c79bd705a56a22cc">list_detach</a>(&amp;rt-&gt;<a class="code" href="structrt__table.html#a9766df03900778ed6369aad09aeb7d43">l</a>);
<a name="l00290"></a>00290             <a class="code" href="NA__routing__table_8cc.html#a01a24c260d1ec566bcae0dc82d3867cf">precursor_list_destroy</a>(rt);
<a name="l00291"></a>00291             free(rt);
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294 <span class="preprocessor">#endif</span>
<a name="l00295"></a>00295 <span class="preprocessor"></span><span class="preprocessor">#ifndef AODV_USE_STL</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span>    <span class="keywordflow">while</span> (!<a class="code" href="NA__list_8cc.html#a25097023f865b93f40baef7477fa0331">list_empty</a>(&amp;rreq_records))
<a name="l00297"></a>00297     {
<a name="l00298"></a>00298         pos = <a class="code" href="NA__list_8cc.html#a0d55f2deea617b57a6ee65085fe5f840">list_first</a>(&amp;rreq_records);
<a name="l00299"></a>00299         <a class="code" href="NA__list_8cc.html#a95fe3a213ff2c475c79bd705a56a22cc">list_detach</a>(pos);
<a name="l00300"></a>00300         <span class="keywordflow">if</span> (pos) free(pos);
<a name="l00301"></a>00301     }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <span class="keywordflow">while</span> (!<a class="code" href="NA__list_8cc.html#a25097023f865b93f40baef7477fa0331">list_empty</a>(&amp;rreq_blacklist))
<a name="l00304"></a>00304     {
<a name="l00305"></a>00305         pos = <a class="code" href="NA__list_8cc.html#a0d55f2deea617b57a6ee65085fe5f840">list_first</a>(&amp;rreq_blacklist);
<a name="l00306"></a>00306         <a class="code" href="NA__list_8cc.html#a95fe3a213ff2c475c79bd705a56a22cc">list_detach</a>(pos);
<a name="l00307"></a>00307         <span class="keywordflow">if</span> (pos) free(pos);
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="keywordflow">while</span> (!<a class="code" href="NA__list_8cc.html#a25097023f865b93f40baef7477fa0331">list_empty</a>(&amp;seekhead))
<a name="l00311"></a>00311     {
<a name="l00312"></a>00312         pos = <a class="code" href="NA__list_8cc.html#a0d55f2deea617b57a6ee65085fe5f840">list_first</a>(&amp;seekhead);
<a name="l00313"></a>00313         <a class="code" href="NA__list_8cc.html#a95fe3a213ff2c475c79bd705a56a22cc">list_detach</a>(pos);
<a name="l00314"></a>00314         <span class="keywordflow">if</span> (pos) free(pos);
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316 <span class="preprocessor">#else</span>
<a name="l00317"></a>00317 <span class="preprocessor"></span>    <span class="keywordflow">while</span> (!rreq_records.empty())
<a name="l00318"></a>00318     {
<a name="l00319"></a>00319         free (rreq_records.back());
<a name="l00320"></a>00320         rreq_records.pop_back();
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323     <span class="keywordflow">while</span> (!rreq_blacklist.empty())
<a name="l00324"></a>00324     {
<a name="l00325"></a>00325         free (rreq_blacklist.begin()-&gt;second);
<a name="l00326"></a>00326         rreq_blacklist.erase(rreq_blacklist.begin());
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="keywordflow">while</span> (!seekhead.empty())
<a name="l00330"></a>00330     {
<a name="l00331"></a>00331         <span class="keyword">delete</span> (seekhead.begin()-&gt;second);
<a name="l00332"></a>00332         seekhead.erase(seekhead.begin());
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334 <span class="preprocessor">#endif</span>
<a name="l00335"></a>00335 <span class="preprocessor"></span>    <a class="code" href="NA__packet__queue__omnet_8cc.html#a486418eea471861e6f0db62fb5344c5a">packet_queue_destroy</a>();
<a name="l00336"></a>00336     cancelAndDelete(sendMessageEvent);
<a name="l00337"></a>00337     <a class="code" href="NA__debug__aodv_8cc.html#ad7f2a4f9e2cabca7e32a3a29fdcd8a79">log_cleanup</a>();
<a name="l00338"></a>00338     <span class="keyword">delete</span> gateWayAddress;
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 <span class="comment">/* NETATTACKS: handle menssage from controller. */</span>
<a name="l00343"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a377fe84396ac3b32067297f56dd2164a">00343</a> <span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a377fe84396ac3b32067297f56dd2164a">handleMessageFromAttackController</a>(cMessage *msg){
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="comment">// It is necessary to call Enter_Method for doing context switching (4.10 of User Manual)</span>
<a name="l00346"></a>00346     Enter_Method(<span class="stringliteral">&quot;NA_AODVUU: handle message from attack controller&quot;</span>);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     <a class="code" href="NA__NesgLog_8h.html#a159ca84d25a5487d8e81e4438725df19" title="LOG macro.">LOG</a> &lt;&lt; <span class="stringliteral">&quot;NA_AODVUU: Received message: &quot;</span>&lt;&lt; msg-&gt;getFullName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350     <span class="comment">// BEGIN NA_SINKHOLE - sancale</span>
<a name="l00351"></a>00351     <span class="comment">// Activate sinkhole</span>
<a name="l00352"></a>00352     <span class="keywordflow">if</span> (not strcmp(msg-&gt;getFullName(), <span class="stringliteral">&quot;sinkholeActivate&quot;</span>)) {
<a name="l00353"></a>00353         NA_SinkholeMessage *dmsg;
<a name="l00354"></a>00354         dmsg = check_and_cast&lt;NA_SinkholeMessage *&gt;(msg);
<a name="l00355"></a>00355         <a class="code" href="NA__NesgLog_8h.html#a159ca84d25a5487d8e81e4438725df19" title="LOG macro.">LOG</a> &lt;&lt; <span class="stringliteral">&quot;--&gt; Activating module NA_AODVUU for Sinkhole...\n&quot;</span>;
<a name="l00356"></a>00356         LOG &lt;&lt; <span class="stringliteral">&quot;    Sinkhole Probability received: &quot;</span>&lt;&lt; dmsg-&gt;getSinkholeAttackProbability() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00357"></a>00357         LOG &lt;&lt; <span class="stringliteral">&quot;    Sink only when route in table: &quot;</span> &lt;&lt; dmsg-&gt;getSinkOnlyWhenRouteInTable() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00358"></a>00358         <span class="comment">//Now sinkhole attack is activated in this module</span>
<a name="l00359"></a>00359         sinkholeAttackIsActive = <span class="keyword">true</span>;
<a name="l00360"></a>00360         sinkholeAttackProbability = dmsg-&gt;getSinkholeAttackProbability();
<a name="l00361"></a>00361         sinkOnlyWhenRouteInTable = dmsg-&gt;getSinkOnlyWhenRouteInTable();
<a name="l00362"></a>00362         seqnoAdded = dmsg-&gt;getSeqnoAdded();
<a name="l00363"></a>00363         numHops = dmsg-&gt;getNumHops();
<a name="l00364"></a>00364         <span class="keyword">delete</span>(msg);
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         <span class="comment">// Deactivate sinkhole</span>
<a name="l00367"></a>00367     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (not strcmp(msg-&gt;getFullName(), <span class="stringliteral">&quot;sinkholeDeactivate&quot;</span>)) {
<a name="l00368"></a>00368         NA_SinkholeMessage *dmsg;
<a name="l00369"></a>00369         dmsg = check_and_cast&lt;NA_SinkholeMessage *&gt;(msg);
<a name="l00370"></a>00370         <a class="code" href="NA__NesgLog_8h.html#a159ca84d25a5487d8e81e4438725df19" title="LOG macro.">LOG</a> &lt;&lt; <span class="stringliteral">&quot;Deactivating module NA_AODVUU for Sinkhole...\n&quot;</span>;
<a name="l00371"></a>00371         <span class="comment">//Now sinkholes attack is deactivated</span>
<a name="l00372"></a>00372         sinkholeAttackIsActive = <span class="keyword">false</span>;
<a name="l00373"></a>00373         seqnoAdded = NULL;
<a name="l00374"></a>00374         numHops = NULL;
<a name="l00375"></a>00375         <span class="keyword">delete</span>(msg);
<a name="l00376"></a>00376      <span class="comment">// END NA_SINKHOLE - sancale</span>
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     } <span class="keywordflow">else</span> {
<a name="l00379"></a>00379         <a class="code" href="NA__NesgLog_8h.html#a159ca84d25a5487d8e81e4438725df19" title="LOG macro.">LOG</a> &lt;&lt; <span class="stringliteral">&quot;ERROR: Message unknown in NA_AODVUU::handleMessageFromAttackController. Msg: &quot;</span> &lt;&lt; msg-&gt;getFullName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381 }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 <span class="comment">/*</span>
<a name="l00385"></a>00385 <span class="comment">  Moves pending packets with a certain next hop from the interface</span>
<a name="l00386"></a>00386 <span class="comment">  queue to the packet buffer or simply drops it.</span>
<a name="l00387"></a>00387 <span class="comment">*/</span>
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="comment">/* Called for packets whose delivery fails at the link layer */</span>
<a name="l00390"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#ae281ab89be96795d96ef568ad395a7c5">00390</a> <span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#ae281ab89be96795d96ef568ad395a7c5">packetFailed</a>(IPv4Datagram *dgram)
<a name="l00391"></a>00391 {
<a name="l00392"></a>00392     <a class="code" href="structrt__table.html">rt_table_t</a> *rt_next_hop, *rt;
<a name="l00393"></a>00393     <span class="keyword">struct </span>in_addr dest_addr, src_addr, next_hop;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     src_addr.s_addr = ManetAddress(dgram-&gt;getSrcAddress());
<a name="l00396"></a>00396     dest_addr.s_addr = ManetAddress(dgram-&gt;getDestAddress());
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 
<a name="l00399"></a>00399     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Got failure callback&quot;</span>);
<a name="l00400"></a>00400     <span class="comment">/* We don&#39;t care about link failures for broadcast or non-data packets */</span>
<a name="l00401"></a>00401     <span class="keywordflow">if</span> (dgram-&gt;getDestAddress().getInt() == IP_BROADCAST ||
<a name="l00402"></a>00402             dgram-&gt;getDestAddress().getInt() == <a class="code" href="NA__defs__aodv_8h.html#a3f5378171d85f4d025988d72cb9eab3c">AODV_BROADCAST</a>)
<a name="l00403"></a>00403     {
<a name="l00404"></a>00404         <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Ignoring callback&quot;</span>);
<a name="l00405"></a>00405         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00406"></a>00406         <span class="keywordflow">return</span>;
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;LINK FAILURE for next_hop=%s dest=%s &quot;</span>,<a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(next_hop), <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(dest_addr));
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (<a class="code" href="NA__seek__list_8cc.html#ae26827bd74face659624808c4d7bd517">seek_list_find</a>(dest_addr))
<a name="l00413"></a>00413     {
<a name="l00414"></a>00414         <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Ongoing route discovery, buffering packet...&quot;</span>);
<a name="l00415"></a>00415         <a class="code" href="NA__packet__queue__omnet_8cc.html#abca7137accdfd65a117cc2df8a1cec70">packet_queue_add</a>((IPv4Datagram *)dgram-&gt;dup(), dest_addr);
<a name="l00416"></a>00416         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00417"></a>00417         <span class="keywordflow">return</span>;
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(dest_addr);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (!rt || rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a>)
<a name="l00424"></a>00424     {
<a name="l00425"></a>00425         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00426"></a>00426         <span class="keywordflow">return</span>;
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428     next_hop.s_addr = rt-&gt;<a class="code" href="structrt__table.html#a1046410b40a5ebff3e93efd435370cb3">next_hop</a>.s_addr;
<a name="l00429"></a>00429     rt_next_hop = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(next_hop);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <span class="keywordflow">if</span> (!rt_next_hop || rt_next_hop-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a>)
<a name="l00432"></a>00432     {
<a name="l00433"></a>00433         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00434"></a>00434         <span class="keywordflow">return</span>;
<a name="l00435"></a>00435     }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <span class="comment">/* Do local repair? */</span>
<a name="l00438"></a>00438     <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#ab289d12fed7e29d1431a3206d813170c">local_repair</a> &amp;&amp; rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a> &lt;= <a class="code" href="NA__params_8h.html#aa2eb3312431e83f4a41ef8926487c5cf">MAX_REPAIR_TTL</a>)
<a name="l00439"></a>00439         <span class="comment">/* &amp;&amp; ch-&gt;num_forwards() &gt; rt-&gt;hcnt */</span>
<a name="l00440"></a>00440     {
<a name="l00441"></a>00441         <span class="comment">/* Buffer the current packet */</span>
<a name="l00442"></a>00442         <a class="code" href="NA__packet__queue__omnet_8cc.html#abca7137accdfd65a117cc2df8a1cec70">packet_queue_add</a>((IPv4Datagram *) dgram-&gt;dup(), dest_addr);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <span class="comment">// In omnet++ it&#39;s not possible to access to the mac queue</span>
<a name="l00445"></a>00445         <span class="comment">//  /* Buffer pending packets from interface queue */</span>
<a name="l00446"></a>00446         <span class="comment">//  interfaceQueue((nsaddr_t) next_hop.s_addr, IFQ_BUFFER);</span>
<a name="l00447"></a>00447         <span class="comment">//  /* Mark the route to be repaired */</span>
<a name="l00448"></a>00448         rt_next_hop-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a> |= <a class="code" href="NA__routing__table_8h.html#a9be54cbcb590c1da1bae887e4fa48152">RT_REPAIR</a>;
<a name="l00449"></a>00449         <a class="code" href="NA__aodv__neighbor_8cc.html#ac0b48998364c3e0b91b3b866808187f0">neighbor_link_break</a>(rt_next_hop);
<a name="l00450"></a>00450         <a class="code" href="NA__aodv__rreq_8cc.html#a44f18f90d4862d93f99c2b197ba61fa3">rreq_local_repair</a>(rt, src_addr, NULL);
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452     <span class="keywordflow">else</span>
<a name="l00453"></a>00453     {
<a name="l00454"></a>00454         <span class="comment">/* No local repair - just force timeout of link and drop packets */</span>
<a name="l00455"></a>00455         <a class="code" href="NA__aodv__neighbor_8cc.html#ac0b48998364c3e0b91b3b866808187f0">neighbor_link_break</a>(rt_next_hop);
<a name="l00456"></a>00456 <span class="comment">// In omnet++ it&#39;s not possible to access to the mac queue</span>
<a name="l00457"></a>00457 <span class="comment">//  interfaceQueue((nsaddr_t) next_hop.s_addr, IFQ_DROP);</span>
<a name="l00458"></a>00458     }
<a name="l00459"></a>00459     <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <span class="comment">/* Called for packets whose delivery fails at the link layer */</span>
<a name="l00464"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a719e65d72818a3b33a6178fad4a13821">00464</a> <span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a719e65d72818a3b33a6178fad4a13821">packetFailedMac</a>(Ieee80211DataFrame *dgram)
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466     <a class="code" href="structrt__table.html">rt_table_t</a> *rt_next_hop, *rt;
<a name="l00467"></a>00467     <span class="keyword">struct </span>in_addr dest_addr, src_addr, next_hop;
<a name="l00468"></a>00468     <span class="keywordflow">if</span> (dgram-&gt;getReceiverAddress().isBroadcast())
<a name="l00469"></a>00469     {
<a name="l00470"></a>00470         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00471"></a>00471         <span class="keywordflow">return</span>;
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474     src_addr.s_addr = ManetAddress(dgram-&gt;getAddress3());
<a name="l00475"></a>00475     dest_addr.s_addr = ManetAddress(dgram-&gt;getAddress4());
<a name="l00476"></a>00476     <span class="keywordflow">if</span> (<a class="code" href="NA__seek__list_8cc.html#ae26827bd74face659624808c4d7bd517">seek_list_find</a>(dest_addr))
<a name="l00477"></a>00477     {
<a name="l00478"></a>00478         <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Ongoing route discovery, buffering packet...&quot;</span>);
<a name="l00479"></a>00479         <a class="code" href="NA__packet__queue__omnet_8cc.html#abca7137accdfd65a117cc2df8a1cec70">packet_queue_add</a>(dgram-&gt;dup(), dest_addr);
<a name="l00480"></a>00480         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00481"></a>00481         <span class="keywordflow">return</span>;
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484     rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(dest_addr);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486     <span class="keywordflow">if</span> (!rt || rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a>)
<a name="l00487"></a>00487     {
<a name="l00488"></a>00488         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00489"></a>00489         <span class="keywordflow">return</span>;
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491     next_hop.s_addr = rt-&gt;<a class="code" href="structrt__table.html#a1046410b40a5ebff3e93efd435370cb3">next_hop</a>.s_addr;
<a name="l00492"></a>00492     rt_next_hop = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(next_hop);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494     <span class="keywordflow">if</span> (!rt_next_hop || rt_next_hop-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a>)
<a name="l00495"></a>00495     {
<a name="l00496"></a>00496         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00497"></a>00497         <span class="keywordflow">return</span>;
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500     <span class="comment">/* Do local repair? */</span>
<a name="l00501"></a>00501     <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#ab289d12fed7e29d1431a3206d813170c">local_repair</a> &amp;&amp; rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a> &lt;= <a class="code" href="NA__params_8h.html#aa2eb3312431e83f4a41ef8926487c5cf">MAX_REPAIR_TTL</a>)
<a name="l00502"></a>00502         <span class="comment">/* &amp;&amp; ch-&gt;num_forwards() &gt; rt-&gt;hcnt */</span>
<a name="l00503"></a>00503     {
<a name="l00504"></a>00504         <span class="comment">/* Buffer the current packet */</span>
<a name="l00505"></a>00505         <a class="code" href="NA__packet__queue__omnet_8cc.html#abca7137accdfd65a117cc2df8a1cec70">packet_queue_add</a>(dgram-&gt;dup(), dest_addr);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         <span class="comment">// In omnet++ it&#39;s not possible to access to the mac queue</span>
<a name="l00508"></a>00508         <span class="comment">//  /* Buffer pending packets from interface queue */</span>
<a name="l00509"></a>00509         <span class="comment">//  interfaceQueue((nsaddr_t) next_hop.s_addr, IFQ_BUFFER);</span>
<a name="l00510"></a>00510         <span class="comment">//  /* Mark the route to be repaired */</span>
<a name="l00511"></a>00511         rt_next_hop-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a> |= <a class="code" href="NA__routing__table_8h.html#a9be54cbcb590c1da1bae887e4fa48152">RT_REPAIR</a>;
<a name="l00512"></a>00512         <a class="code" href="NA__aodv__neighbor_8cc.html#ac0b48998364c3e0b91b3b866808187f0">neighbor_link_break</a>(rt_next_hop);
<a name="l00513"></a>00513         <a class="code" href="NA__aodv__rreq_8cc.html#a44f18f90d4862d93f99c2b197ba61fa3">rreq_local_repair</a>(rt, src_addr, NULL);
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515     <span class="keywordflow">else</span>
<a name="l00516"></a>00516     {
<a name="l00517"></a>00517         <span class="comment">/* No local repair - just force timeout of link and drop packets */</span>
<a name="l00518"></a>00518         <a class="code" href="NA__aodv__neighbor_8cc.html#ac0b48998364c3e0b91b3b866808187f0">neighbor_link_break</a>(rt_next_hop);
<a name="l00519"></a>00519 <span class="comment">// In omnet++ it&#39;s not possible to access to the mac queue</span>
<a name="l00520"></a>00520 <span class="comment">//  interfaceQueue((nsaddr_t) next_hop.s_addr, IFQ_DROP);</span>
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522     <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 <span class="comment">/* Entry-level packet reception */</span>
<a name="l00528"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a0f45a86aca07b4d03e53674c5a439e62">00528</a> <span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a0f45a86aca07b4d03e53674c5a439e62">handleMessage</a> (cMessage *msg)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530     <a class="code" href="structAODV__msg.html">AODV_msg</a> *aodvMsg=NULL;
<a name="l00531"></a>00531     IPv4Datagram * ipDgram=NULL;
<a name="l00532"></a>00532     UDPPacket * udpPacket=NULL;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     cMessage *msg_aux;
<a name="l00535"></a>00535     <span class="keyword">struct </span>in_addr src_addr;
<a name="l00536"></a>00536     <span class="keyword">struct </span>in_addr dest_addr;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (is_init==<span class="keyword">false</span>)
<a name="l00539"></a>00539         opp_error (<span class="stringliteral">&quot;Aodv has not been initialized &quot;</span>);
<a name="l00540"></a>00540     <span class="keywordflow">if</span> (msg==sendMessageEvent)
<a name="l00541"></a>00541     {
<a name="l00542"></a>00542         <span class="comment">// timer event</span>
<a name="l00543"></a>00543         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00544"></a>00544         <span class="keywordflow">return</span>;
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546     <span class="comment">/* Handle packet depending on type */</span>
<a name="l00547"></a>00547     <span class="keywordflow">if</span> (dynamic_cast&lt;ControlManetRouting *&gt;(msg))
<a name="l00548"></a>00548     {
<a name="l00549"></a>00549         ControlManetRouting * control =  check_and_cast &lt;ControlManetRouting *&gt; (msg);
<a name="l00550"></a>00550         <span class="keywordflow">if</span> (control-&gt;getOptionCode()== MANET_ROUTE_NOROUTE)
<a name="l00551"></a>00551         {
<a name="l00552"></a>00552             ipDgram = (IPv4Datagram*) control-&gt;decapsulate();
<a name="l00553"></a>00553             cPolymorphic * ctrl = ipDgram-&gt;removeControlInfo();
<a name="l00554"></a>00554             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ifindex = NS_IFINDEX;  <span class="comment">/* Always use ns interface */</span>
<a name="l00555"></a>00555             <span class="keywordflow">if</span> (ctrl)
<a name="l00556"></a>00556             {
<a name="l00557"></a>00557                 <span class="keywordflow">if</span> (dynamic_cast&lt;Ieee802Ctrl*&gt; (ctrl))
<a name="l00558"></a>00558                 {
<a name="l00559"></a>00559                     Ieee802Ctrl *ieeectrl = <span class="keyword">dynamic_cast&lt;</span>Ieee802Ctrl*<span class="keyword">&gt;</span> (ctrl);
<a name="l00560"></a>00560                     ManetAddress address(ieeectrl-&gt;getDest());
<a name="l00561"></a>00561                     <span class="keywordtype">int</span> index = getWlanInterfaceIndexByAddress(address);
<a name="l00562"></a>00562                     <span class="keywordflow">if</span> (index!=-1)
<a name="l00563"></a>00563                         ifindex = index;
<a name="l00564"></a>00564                 }
<a name="l00565"></a>00565                 <span class="keyword">delete</span> ctrl;
<a name="l00566"></a>00566             }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568             EV &lt;&lt; <span class="stringliteral">&quot;Aodv rec datagram  &quot;</span> &lt;&lt; ipDgram-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; with dest=&quot;</span> &lt;&lt; ipDgram-&gt;getDestAddress().str() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00569"></a>00569             <a class="code" href="NA__aodv__uu__omnet_8cc.html#a1f27f26ef21c3d67952b82bb3a400326">processPacket</a>(ipDgram,ifindex);   <span class="comment">// Data path</span>
<a name="l00570"></a>00570         }
<a name="l00571"></a>00571         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (control-&gt;getOptionCode()== MANET_ROUTE_UPDATE)
<a name="l00572"></a>00572         {
<a name="l00573"></a>00573             <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;forwarding packers, actualize time outs&quot;</span>);
<a name="l00574"></a>00574             src_addr.s_addr = control-&gt;getSrcAddress();
<a name="l00575"></a>00575             dest_addr.s_addr = control-&gt;getDestAddress();
<a name="l00576"></a>00576             <a class="code" href="structrt__table.html">rt_table_t</a> * fwd_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(dest_addr);
<a name="l00577"></a>00577             <a class="code" href="structrt__table.html">rt_table_t</a> * rev_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(src_addr);
<a name="l00578"></a>00578             <a class="code" href="NA__routing__table_8cc.html#a438604d7812eff676f0273d700177bc8">rt_table_update_route_timeouts</a>(fwd_rt, rev_rt);
<a name="l00579"></a>00579             <span class="comment">/* When forwarding data, make sure we are sending HELLO messages */</span>
<a name="l00580"></a>00580             gettimeofday(&amp;<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a0685a8df41c78308172736070f16bcfa">fwd_time</a>, NULL);
<a name="l00581"></a>00581         }
<a name="l00582"></a>00582         <span class="keyword">delete</span> msg;
<a name="l00583"></a>00583         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00584"></a>00584         <span class="keywordflow">return</span>;
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;UDPPacket *&gt;(msg) || dynamic_cast&lt;AODV_msg  *&gt;(msg))
<a name="l00587"></a>00587     {
<a name="l00588"></a>00588         udpPacket = NULL;
<a name="l00589"></a>00589         <span class="keywordflow">if</span> (!isInMacLayer())
<a name="l00590"></a>00590         {
<a name="l00591"></a>00591             udpPacket = check_and_cast&lt;UDPPacket*&gt;(msg);
<a name="l00592"></a>00592             <span class="keywordflow">if</span> (udpPacket-&gt;getDestinationPort()!= 654)
<a name="l00593"></a>00593             {
<a name="l00594"></a>00594                 <span class="keyword">delete</span>  msg;
<a name="l00595"></a>00595                 <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00596"></a>00596                 <span class="keywordflow">return</span>;
<a name="l00597"></a>00597             }
<a name="l00598"></a>00598             msg_aux  = udpPacket-&gt;decapsulate();
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600         <span class="keywordflow">else</span>
<a name="l00601"></a>00601             msg_aux = msg;
<a name="l00602"></a>00602 
<a name="l00603"></a>00603         <span class="keywordflow">if</span> (dynamic_cast&lt;AODV_msg  *&gt;(msg_aux))
<a name="l00604"></a>00604         {
<a name="l00605"></a>00605             aodvMsg = check_and_cast  &lt;<a class="code" href="structAODV__msg.html">AODV_msg</a> *&gt;(msg_aux);
<a name="l00606"></a>00606             <span class="keywordflow">if</span> (!isInMacLayer())
<a name="l00607"></a>00607             {
<a name="l00608"></a>00608                 IPv4ControlInfo *controlInfo = check_and_cast&lt;IPv4ControlInfo*&gt;(udpPacket-&gt;removeControlInfo());
<a name="l00609"></a>00609                 src_addr.s_addr = ManetAddress(controlInfo-&gt;getSrcAddr());
<a name="l00610"></a>00610                 aodvMsg-&gt;setControlInfo(controlInfo);
<a name="l00611"></a>00611             }
<a name="l00612"></a>00612             <span class="keywordflow">else</span>
<a name="l00613"></a>00613             {
<a name="l00614"></a>00614                 Ieee802Ctrl *controlInfo = check_and_cast&lt;Ieee802Ctrl*&gt;(udpPacket-&gt;getControlInfo());
<a name="l00615"></a>00615                 src_addr.s_addr = ManetAddress(controlInfo-&gt;getSrc());
<a name="l00616"></a>00616             }
<a name="l00617"></a>00617         }
<a name="l00618"></a>00618         <span class="keywordflow">else</span>
<a name="l00619"></a>00619         {
<a name="l00620"></a>00620             <span class="keywordflow">if</span> (udpPacket)
<a name="l00621"></a>00621                 <span class="keyword">delete</span> udpPacket;
<a name="l00622"></a>00622             <span class="keyword">delete</span> msg_aux;
<a name="l00623"></a>00623             <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00624"></a>00624             <span class="keywordflow">return</span>;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626         }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628         <span class="keywordflow">if</span> (udpPacket)
<a name="l00629"></a>00629             <span class="keyword">delete</span> udpPacket;
<a name="l00630"></a>00630     }
<a name="l00631"></a>00631     <span class="keywordflow">else</span>
<a name="l00632"></a>00632     {
<a name="l00633"></a>00633         <span class="keyword">delete</span> msg;
<a name="l00634"></a>00634         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00635"></a>00635         <span class="keywordflow">return</span>;
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637     <span class="comment">/* Detect routing loops */</span>
<a name="l00638"></a>00638     <span class="keywordflow">if</span> (isLocalAddress(src_addr.s_addr))
<a name="l00639"></a>00639     {
<a name="l00640"></a>00640         <span class="keyword">delete</span> aodvMsg;
<a name="l00641"></a>00641         aodvMsg=NULL;
<a name="l00642"></a>00642         <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00643"></a>00643         <span class="keywordflow">return</span>;
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645     <a class="code" href="NA__aodv__uu__omnet_8cc.html#a8cb8c2e2b22e66445f91073114decaf8">recvAODVUUPacket</a>(aodvMsg);
<a name="l00646"></a>00646     <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00647"></a>00647 }
<a name="l00648"></a>00648 <span class="comment">/*</span>
<a name="l00649"></a>00649 <span class="comment">      case PT_ENCAPSULATED:</span>
<a name="l00650"></a>00650 <span class="comment">    // Decapsulate...</span>
<a name="l00651"></a>00651 <span class="comment">    if (internet_gw_mode) {</span>
<a name="l00652"></a>00652 <span class="comment">        rt_table_t *rev_rt, *next_hop_rt;</span>
<a name="l00653"></a>00653 <span class="comment">         rev_rt = rt_table_find(saddr);</span>
<a name="l00654"></a>00654 <span class="comment"></span>
<a name="l00655"></a>00655 <span class="comment">         if (rev_rt &amp;&amp; rev_rt-&gt;state == VALID) {</span>
<a name="l00656"></a>00656 <span class="comment">         rt_table_update_timeout(rev_rt, ACTIVE_ROUTE_TIMEOUT);</span>
<a name="l00657"></a>00657 <span class="comment"></span>
<a name="l00658"></a>00658 <span class="comment">         next_hop_rt = rt_table_find(rev_rt-&gt;next_hop);</span>
<a name="l00659"></a>00659 <span class="comment"></span>
<a name="l00660"></a>00660 <span class="comment">         if (next_hop_rt &amp;&amp; next_hop_rt-&gt;state == VALID &amp;&amp;</span>
<a name="l00661"></a>00661 <span class="comment">             rev_rt &amp;&amp; next_hop_rt-&gt;dest_addr.s_addr != rev_rt-&gt;dest_addr.s_addr)</span>
<a name="l00662"></a>00662 <span class="comment">             rt_table_update_timeout(next_hop_rt, ACTIVE_ROUTE_TIMEOUT);</span>
<a name="l00663"></a>00663 <span class="comment">         }</span>
<a name="l00664"></a>00664 <span class="comment">         p = pkt_decapsulate(p);</span>
<a name="l00665"></a>00665 <span class="comment"></span>
<a name="l00666"></a>00666 <span class="comment">         target_-&gt;recv(p, (Handler *)0);</span>
<a name="l00667"></a>00667 <span class="comment">         break;</span>
<a name="l00668"></a>00668 <span class="comment">    }</span>
<a name="l00669"></a>00669 <span class="comment"></span>
<a name="l00670"></a>00670 <span class="comment">    processPacket(p);   // Data path</span>
<a name="l00671"></a>00671 <span class="comment">    }</span>
<a name="l00672"></a>00672 <span class="comment">*/</span>
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 <span class="comment">/* Starts the AODV-UU routing agent */</span>
<a name="l00677"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#ac2022163ffdaa951d130a0aba7881552">00677</a> <span class="keywordtype">int</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#ac2022163ffdaa951d130a0aba7881552">startAODVUUAgent</a>()
<a name="l00678"></a>00678 {
<a name="l00679"></a>00679 
<a name="l00680"></a>00680     <span class="comment">/* Set up the wait-on-reboot timer */</span>
<a name="l00681"></a>00681     <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#ae9b50005184bab60e94309c7a30c5c85">wait_on_reboot</a>)
<a name="l00682"></a>00682     {
<a name="l00683"></a>00683         <a class="code" href="NA__timer__queue__aodv_8cc.html#a721feeb3bf29621e58f8914c0d5365c0">timer_init</a>(&amp;<a class="code" href="main_8c.html#a102638bbe37dfc0788ddc7de6afbffe5">worb_timer</a>, &amp;<a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__timeout_8cc.html#a5ed6c5e23736c182228b2b5c3382c5ad">wait_on_reboot_timeout</a>, &amp;<a class="code" href="main_8c.html#ae9b50005184bab60e94309c7a30c5c85">wait_on_reboot</a>);
<a name="l00684"></a>00684         <a class="code" href="NA__timer__queue__aodv_8cc.html#ace41c2dc22720e5daac03344ac0a4102">timer_set_timeout</a>(&amp;<a class="code" href="main_8c.html#a102638bbe37dfc0788ddc7de6afbffe5">worb_timer</a>, <a class="code" href="NA__params_8h.html#a649583ef8b5c7fb8211d207e7776f3f9">DELETE_PERIOD</a>);
<a name="l00685"></a>00685         <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_NOTICE, 0, <span class="stringliteral">&quot;In wait on reboot for %d milliseconds.&quot;</span>,<a class="code" href="NA__params_8h.html#a649583ef8b5c7fb8211d207e7776f3f9">DELETE_PERIOD</a>);
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687     <span class="comment">/* Schedule the first HELLO */</span>
<a name="l00688"></a>00688     <span class="keywordflow">if</span> (!<a class="code" href="main_8c.html#a20ce58c799d3953a9d57e6c3f8910633">llfeedback</a> &amp;&amp; !<a class="code" href="main_8c.html#aff2e4196aa2a66f42a9688b5dde5cbd8">optimized_hellos</a>)
<a name="l00689"></a>00689         <a class="code" href="NA__aodv__hello_8cc.html#ab6bcab8fcfe60a3dfdb059c4f96c402b">hello_start</a>();
<a name="l00690"></a>00690 
<a name="l00691"></a>00691     <span class="comment">/* Initialize routing table logging */</span>
<a name="l00692"></a>00692     <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a10b915edc92aec7ca4584b10aacdb7e7">rt_log_interval</a>)
<a name="l00693"></a>00693         <a class="code" href="NA__debug__aodv_8cc.html#ad648b58f4087c21b60e97762f4d87bf8">log_rt_table_init</a>();
<a name="l00694"></a>00694 
<a name="l00695"></a>00695     <span class="comment">/* Initialization complete */</span>
<a name="l00696"></a>00696     initialized = 1;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Routing agent with IP = %s  started.&quot;</span>,
<a name="l00699"></a>00699           <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(<a class="code" href="NA__defs__aodv_8h.html#ab95b1afa61dd1a2cf987d8a56ad6be03">DEV_NR</a>(NS_DEV_NR).ipaddr));
<a name="l00700"></a>00700 
<a name="l00701"></a>00701     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Settings:&quot;</span>);
<a name="l00702"></a>00702     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;unidir_hack %s&quot;</span>, <a class="code" href="main_8c.html#ae55eec632e369a4afc18e804bae8f3e4">unidir_hack</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00703"></a>00703     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;rreq_gratuitous %s&quot;</span>, <a class="code" href="main_8c.html#a9114356a8b6ad57f39c4d50388776531">rreq_gratuitous</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00704"></a>00704     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;expanding_ring_search %s&quot;</span>, <a class="code" href="main_8c.html#a09464654a5c100dc4840caefec4672b0">expanding_ring_search</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00705"></a>00705     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;local_repair %s&quot;</span>, <a class="code" href="main_8c.html#ab289d12fed7e29d1431a3206d813170c">local_repair</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00706"></a>00706     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;receive_n_hellos %s&quot;</span>, <a class="code" href="main_8c.html#aa10c5b3c1ff250cd241fe589fdf92253">receive_n_hellos</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00707"></a>00707     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;hello_jittering %s&quot;</span>, <a class="code" href="main_8c.html#a5195b41adb4586d2ad897d08ebb3dfad">hello_jittering</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00708"></a>00708     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;wait_on_reboot %s&quot;</span>, <a class="code" href="main_8c.html#ae9b50005184bab60e94309c7a30c5c85">wait_on_reboot</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00709"></a>00709     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;optimized_hellos %s&quot;</span>, <a class="code" href="main_8c.html#aff2e4196aa2a66f42a9688b5dde5cbd8">optimized_hellos</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00710"></a>00710     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;ratelimit %s&quot;</span>, <a class="code" href="main_8c.html#a3ecfcf4b066b9c242e176393695e38d0">ratelimit</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00711"></a>00711     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;llfeedback %s&quot;</span>, <a class="code" href="main_8c.html#a20ce58c799d3953a9d57e6c3f8910633">llfeedback</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00712"></a>00712     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;internet_gw_mode %s&quot;</span>, <a class="code" href="main_8c.html#a6be52079b3b26f9986ccdddfbca964e6">internet_gw_mode</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l00713"></a>00713     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;ACTIVE_ROUTE_TIMEOUT=%d&quot;</span>, <a class="code" href="NA__params_8h.html#aba91511b61e5a1a42aba4ae0805c6dfa">ACTIVE_ROUTE_TIMEOUT</a>);
<a name="l00714"></a>00714     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;TTL_START=%d&quot;</span>, <a class="code" href="NA__params_8h.html#a25ab47cb76166dd649dfb39459efa2a8">TTL_START</a>);
<a name="l00715"></a>00715     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;DELETE_PERIOD=%d&quot;</span>, <a class="code" href="NA__params_8h.html#a649583ef8b5c7fb8211d207e7776f3f9">DELETE_PERIOD</a>);
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     <span class="comment">/* Schedule the first timeout */</span>
<a name="l00718"></a>00718     <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l00719"></a>00719     <span class="keywordflow">return</span> 0;
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 <span class="comment">// for use with gateway in the future</span>
<a name="l00726"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#aad0b14ba05f9ee915178379bee41ab47">00726</a> IPv4Datagram * <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#aad0b14ba05f9ee915178379bee41ab47">pkt_encapsulate</a>(IPv4Datagram *p, IPv4Address gateway)
<a name="l00727"></a>00727 {
<a name="l00728"></a>00728     IPv4Datagram *datagram = <span class="keyword">new</span> IPv4Datagram(p-&gt;getName());
<a name="l00729"></a>00729     datagram-&gt;setByteLength(IP_HEADER_BYTES);
<a name="l00730"></a>00730     datagram-&gt;encapsulate(p);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732     <span class="comment">// set source and destination address</span>
<a name="l00733"></a>00733     datagram-&gt;setDestAddress(gateway);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     IPv4Address src = p-&gt;getSrcAddress();
<a name="l00736"></a>00736 
<a name="l00737"></a>00737     <span class="comment">// when source address was given, use it; otherwise it&#39;ll get the address</span>
<a name="l00738"></a>00738     <span class="comment">// of the outgoing interface after routing</span>
<a name="l00739"></a>00739     <span class="comment">// set other fields</span>
<a name="l00740"></a>00740     datagram-&gt;setTypeOfService(p-&gt;getTypeOfService());
<a name="l00741"></a>00741     datagram-&gt;setIdentification(p-&gt;getIdentification());
<a name="l00742"></a>00742     datagram-&gt;setMoreFragments(<span class="keyword">false</span>);
<a name="l00743"></a>00743     datagram-&gt;setDontFragment (p-&gt;getDontFragment());
<a name="l00744"></a>00744     datagram-&gt;setFragmentOffset(0);
<a name="l00745"></a>00745     datagram-&gt;setTimeToLive(
<a name="l00746"></a>00746         p-&gt;getTimeToLive() &gt; 0 ?
<a name="l00747"></a>00747         p-&gt;getTimeToLive() :
<a name="l00748"></a>00748         0);
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     datagram-&gt;setTransportProtocol(IP_PROT_IP);
<a name="l00751"></a>00751     <span class="keywordflow">return</span> datagram;
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 
<a name="l00756"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#ad5ff0cdaf314807a4b4747e4e0085c71">00756</a> IPv4Datagram *<a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#ad5ff0cdaf314807a4b4747e4e0085c71">pkt_decapsulate</a>(IPv4Datagram *p)
<a name="l00757"></a>00757 {
<a name="l00758"></a>00758 
<a name="l00759"></a>00759     <span class="keywordflow">if</span> (p-&gt;getTransportProtocol() == IP_PROT_IP)
<a name="l00760"></a>00760     {
<a name="l00761"></a>00761         IPv4Datagram *datagram = check_and_cast  &lt;IPv4Datagram *&gt;(p-&gt;decapsulate());
<a name="l00762"></a>00762         datagram-&gt;setTimeToLive(p-&gt;getTimeToLive());
<a name="l00763"></a>00763         <span class="keyword">delete</span> p;
<a name="l00764"></a>00764         <span class="keywordflow">return</span> datagram;
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766     <span class="keywordflow">return</span> NULL;
<a name="l00767"></a>00767 }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769 
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 <span class="comment">/*</span>
<a name="l00772"></a>00772 <span class="comment">  Reschedules the timer queue timer to go off at the time of the</span>
<a name="l00773"></a>00773 <span class="comment">  earliest event (so that the timer queue will be investigated then).</span>
<a name="l00774"></a>00774 <span class="comment">  Should be called whenever something might have changed the timer queue.</span>
<a name="l00775"></a>00775 <span class="comment">*/</span>
<a name="l00776"></a>00776 <span class="preprocessor">#ifdef AODV_USE_STL</span>
<a name="l00777"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">00777</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>()
<a name="l00778"></a>00778 {
<a name="l00779"></a>00779     simtime_t <a class="code" href="structtimer.html">timer</a>;
<a name="l00780"></a>00780     simtime_t timeout = <a class="code" href="NA__timer__queue__aodv_8cc.html#a07af83c3d8ae6d413f20d06e28a0d10f">timer_age_queue</a>();
<a name="l00781"></a>00781 
<a name="l00782"></a>00782     <span class="keywordflow">if</span> (!aodvTimerMap.empty())
<a name="l00783"></a>00783     {
<a name="l00784"></a>00784         timer = aodvTimerMap.begin()-&gt;first;
<a name="l00785"></a>00785         <span class="keywordflow">if</span> (sendMessageEvent-&gt;isScheduled())
<a name="l00786"></a>00786         {
<a name="l00787"></a>00787             <span class="keywordflow">if</span> (<a class="code" href="structtimer.html">timer &lt; sendMessageEvent-&gt;</a>getArrivalTime())
<a name="l00788"></a>00788             {
<a name="l00789"></a>00789                 cancelEvent(sendMessageEvent);
<a name="l00790"></a>00790                 scheduleAt(timer, sendMessageEvent);
<a name="l00791"></a>00791             }
<a name="l00792"></a>00792         }
<a name="l00793"></a>00793         <span class="keywordflow">else</span>
<a name="l00794"></a>00794         {
<a name="l00795"></a>00795             scheduleAt(timer, sendMessageEvent);
<a name="l00796"></a>00796         }
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798 }
<a name="l00799"></a>00799 <span class="preprocessor">#else</span>
<a name="l00800"></a>00800 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>()
<a name="l00801"></a>00801 {
<a name="l00802"></a>00802     <span class="keyword">struct </span>timeval *timeout;
<a name="l00803"></a>00803     <span class="keywordtype">double</span> delay;
<a name="l00804"></a>00804     simtime_t <a class="code" href="structtimer.html">timer</a>;
<a name="l00805"></a>00805     timeout = <a class="code" href="NA__timer__queue__aodv_8cc.html#a07af83c3d8ae6d413f20d06e28a0d10f">timer_age_queue</a>();
<a name="l00806"></a>00806     <span class="keywordflow">if</span> (timeout)
<a name="l00807"></a>00807     {
<a name="l00808"></a>00808         delay  = (double)(((<span class="keywordtype">double</span>)timeout-&gt;tv_usec/(<span class="keywordtype">double</span>)1000000.0) +(double)timeout-&gt;tv_sec);
<a name="l00809"></a>00809         timer = simTime()+delay;
<a name="l00810"></a>00810         <span class="keywordflow">if</span> (sendMessageEvent-&gt;isScheduled())
<a name="l00811"></a>00811         {
<a name="l00812"></a>00812             <span class="keywordflow">if</span> (<a class="code" href="structtimer.html">timer &lt; sendMessageEvent-&gt;</a>getArrivalTime())
<a name="l00813"></a>00813             {
<a name="l00814"></a>00814                 cancelEvent(sendMessageEvent);
<a name="l00815"></a>00815                 scheduleAt(timer, sendMessageEvent);
<a name="l00816"></a>00816             }
<a name="l00817"></a>00817         }
<a name="l00818"></a>00818         <span class="keywordflow">else</span>
<a name="l00819"></a>00819         {
<a name="l00820"></a>00820             scheduleAt(timer, sendMessageEvent);
<a name="l00821"></a>00821         }
<a name="l00822"></a>00822     }
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824 <span class="preprocessor">#endif</span>
<a name="l00825"></a>00825 <span class="preprocessor"></span>
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 <span class="comment">/*</span>
<a name="l00829"></a>00829 <span class="comment">  Replacement for if_indextoname(), used in routing table logging.</span>
<a name="l00830"></a>00830 <span class="comment">*/</span>
<a name="l00831"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a2e4aac37cd617a4ec5bccaeb11747534">00831</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a2e4aac37cd617a4ec5bccaeb11747534">if_indextoname</a>(<span class="keywordtype">int</span> ifindex, <span class="keywordtype">char</span> *ifname)
<a name="l00832"></a>00832 {
<a name="l00833"></a>00833     InterfaceEntry *   ie;
<a name="l00834"></a>00834     assert(ifindex &gt;= 0);
<a name="l00835"></a>00835     ie = getInterfaceEntry(ifindex);
<a name="l00836"></a>00836     <span class="keywordflow">return</span> ie-&gt;getName();
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 
<a name="l00840"></a>00840 
<a name="l00841"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a8cb8c2e2b22e66445f91073114decaf8">00841</a> <span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a8cb8c2e2b22e66445f91073114decaf8">recvAODVUUPacket</a>(cMessage * msg)
<a name="l00842"></a>00842 {
<a name="l00843"></a>00843     <span class="keyword">struct </span>in_addr src, dst;
<a name="l00844"></a>00844     <span class="keywordtype">int</span> ttl;
<a name="l00845"></a>00845     <span class="keywordtype">int</span> interfaceId;
<a name="l00846"></a>00846 
<a name="l00847"></a>00847     <a class="code" href="structAODV__msg.html">AODV_msg</a> *aodv_msg = check_and_cast&lt;<a class="code" href="structAODV__msg.html">AODV_msg</a> *&gt; (msg);
<a name="l00848"></a>00848     <span class="keywordtype">int</span> len = aodv_msg-&gt;getByteLength();
<a name="l00849"></a>00849     <span class="keywordtype">int</span> ifIndex=NS_IFINDEX;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851     ttl =  aodv_msg-&gt;<a class="code" href="structAODV__msg.html#a14556cf0f421518fc2e073d4ba23ca25">ttl</a>-1;
<a name="l00852"></a>00852     <span class="keywordflow">if</span> (!isInMacLayer())
<a name="l00853"></a>00853     {
<a name="l00854"></a>00854         IPv4ControlInfo *ctrl = check_and_cast&lt;IPv4ControlInfo *&gt;(msg-&gt;getControlInfo());
<a name="l00855"></a>00855         IPvXAddress srcAddr = ctrl-&gt;getSrcAddr();
<a name="l00856"></a>00856         IPvXAddress destAddr = ctrl-&gt;getDestAddr();
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         src.s_addr = ManetAddress(srcAddr);
<a name="l00859"></a>00859         dst.s_addr =  ManetAddress(destAddr);
<a name="l00860"></a>00860         interfaceId = ctrl-&gt;getInterfaceId();
<a name="l00861"></a>00861 
<a name="l00862"></a>00862     }
<a name="l00863"></a>00863     <span class="keywordflow">else</span>
<a name="l00864"></a>00864     {
<a name="l00865"></a>00865         Ieee802Ctrl *ctrl = check_and_cast&lt;Ieee802Ctrl *&gt;(msg-&gt;getControlInfo());
<a name="l00866"></a>00866         src.s_addr = ManetAddress(ctrl-&gt;getSrc());
<a name="l00867"></a>00867         dst.s_addr =  ManetAddress(ctrl-&gt;getDest());
<a name="l00868"></a>00868     }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870     InterfaceEntry *   ie;
<a name="l00871"></a>00871     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; getNumWlanInterfaces(); i++)
<a name="l00872"></a>00872     {
<a name="l00873"></a>00873         ie = getWlanInterfaceEntry(i);
<a name="l00874"></a>00874         <span class="keywordflow">if</span> (!isInMacLayer())
<a name="l00875"></a>00875         {
<a name="l00876"></a>00876             IPv4InterfaceData *ipv4data = ie-&gt;ipv4Data();
<a name="l00877"></a>00877             <span class="keywordflow">if</span> (interfaceId ==ie-&gt;getInterfaceId())
<a name="l00878"></a>00878                 ifIndex=getWlanInterfaceIndex(i);
<a name="l00879"></a>00879 
<a name="l00880"></a>00880             <span class="keywordflow">if</span> (ManetAddress(ipv4data-&gt;getIPAddress()) == src.s_addr)
<a name="l00881"></a>00881             {
<a name="l00882"></a>00882                 <span class="keyword">delete</span>   aodv_msg;
<a name="l00883"></a>00883                 <span class="keywordflow">return</span>;
<a name="l00884"></a>00884             }
<a name="l00885"></a>00885         }
<a name="l00886"></a>00886         <span class="keywordflow">else</span>
<a name="l00887"></a>00887         {
<a name="l00888"></a>00888             ManetAddress add(ie-&gt;getMacAddress());
<a name="l00889"></a>00889             <span class="keywordflow">if</span> (add== src.s_addr)
<a name="l00890"></a>00890             {
<a name="l00891"></a>00891                 <span class="keyword">delete</span>   aodv_msg;
<a name="l00892"></a>00892                 <span class="keywordflow">return</span>;
<a name="l00893"></a>00893             }
<a name="l00894"></a>00894         }
<a name="l00895"></a>00895     }
<a name="l00896"></a>00896     <a class="code" href="NA__aodv__socket_8cc.html#af59302e6c2e2f42307dd63ec3a56d4bd">aodv_socket_process_packet</a>(aodv_msg, len, src, dst, ttl, ifIndex);
<a name="l00897"></a>00897     <span class="keyword">delete</span>   aodv_msg;
<a name="l00898"></a>00898 }
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 
<a name="l00901"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a1f27f26ef21c3d67952b82bb3a400326">00901</a> <span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a1f27f26ef21c3d67952b82bb3a400326">processPacket</a>(IPv4Datagram * p,<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ifindex)
<a name="l00902"></a>00902 {
<a name="l00903"></a>00903     <a class="code" href="structrt__table.html">rt_table_t</a> *fwd_rt, *rev_rt;
<a name="l00904"></a>00904     <span class="keyword">struct </span>in_addr dest_addr, src_addr;
<a name="l00905"></a>00905     u_int8_t rreq_flags = 0;
<a name="l00906"></a>00906     <span class="keyword">struct </span><a class="code" href="structip__data.html">ip_data</a> *ipd = NULL;
<a name="l00907"></a>00907 
<a name="l00908"></a>00908 
<a name="l00909"></a>00909     fwd_rt = NULL;      <span class="comment">/* For broadcast we provide no next hop */</span>
<a name="l00910"></a>00910     ipd = NULL;         <span class="comment">/* No ICMP messaging */</span>
<a name="l00911"></a>00911 
<a name="l00912"></a>00912     <span class="keywordtype">bool</span> isLocal=<span class="keyword">true</span>;
<a name="l00913"></a>00913 
<a name="l00914"></a>00914     src_addr.s_addr = ManetAddress(p-&gt;getSrcAddress());
<a name="l00915"></a>00915     dest_addr.s_addr = ManetAddress(p-&gt;getDestAddress());
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     InterfaceEntry *   ie;
<a name="l00918"></a>00918 
<a name="l00919"></a>00919     <span class="keywordflow">if</span> (!p-&gt;getSrcAddress().isUnspecified())
<a name="l00920"></a>00920     {
<a name="l00921"></a>00921         isLocal = isLocalAddress(ManetAddress(p-&gt;getSrcAddress()));
<a name="l00922"></a>00922     }
<a name="l00923"></a>00923 
<a name="l00924"></a>00924     ie = getInterfaceEntry (ifindex);
<a name="l00925"></a>00925     <span class="keywordflow">if</span> (p-&gt;getTransportProtocol()==IP_PROT_TCP)
<a name="l00926"></a>00926         rreq_flags |= <a class="code" href="NA__aodv__rreq_8h.html#a064b5e5007e297023c926e9c08a83fe6">RREQ_GRATUITOUS</a>;
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="comment">/* If this is a TCP packet and we don&#39;t have a route, we should</span>
<a name="l00929"></a>00929 <span class="comment">       set the gratuituos flag in the RREQ. */</span>
<a name="l00930"></a>00930     <span class="keywordtype">bool</span> isMcast = ie-&gt;ipv4Data()-&gt;isMemberOfMulticastGroup(dest_addr.s_addr.getIPv4());
<a name="l00931"></a>00931 
<a name="l00932"></a>00932     <span class="comment">/* If the packet is not interesting we just let it go through... */</span>
<a name="l00933"></a>00933     <span class="keywordflow">if</span> (isMcast || dest_addr.s_addr == ManetAddress(IPv4Address(<a class="code" href="NA__defs__aodv_8h.html#a3f5378171d85f4d025988d72cb9eab3c">AODV_BROADCAST</a>)))
<a name="l00934"></a>00934     {
<a name="l00935"></a>00935         send(p,<span class="stringliteral">&quot;to_ip&quot;</span>);
<a name="l00936"></a>00936         <span class="keywordflow">return</span>;
<a name="l00937"></a>00937     }
<a name="l00938"></a>00938     <span class="comment">/* Find the entry of the neighboring node and the destination  (if any). */</span>
<a name="l00939"></a>00939     rev_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(src_addr);
<a name="l00940"></a>00940     fwd_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(dest_addr);
<a name="l00941"></a>00941 
<a name="l00942"></a>00942 <span class="preprocessor">#ifdef CONFIG_GATEWAY</span>
<a name="l00943"></a>00943 <span class="preprocessor"></span>    <span class="comment">/* Check if we have a route and it is an Internet destination (Should be</span>
<a name="l00944"></a>00944 <span class="comment">     * encapsulated and routed through the gateway). */</span>
<a name="l00945"></a>00945     <span class="keywordflow">if</span> (fwd_rt &amp;&amp; (fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>) &amp;&amp;
<a name="l00946"></a>00946             (fwd_rt-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a> &amp; <a class="code" href="NA__routing__table_8h.html#a4f25f14df0966a49e4c012e651688179">RT_INET_DEST</a>))
<a name="l00947"></a>00947     {
<a name="l00948"></a>00948         <span class="comment">/* The destination should be relayed through the IG */</span>
<a name="l00949"></a>00949 
<a name="l00950"></a>00950         <a class="code" href="NA__routing__table_8cc.html#a26317d59b04b99645fb385905635422c">rt_table_update_timeout</a>(fwd_rt, <a class="code" href="NA__params_8h.html#aba91511b61e5a1a42aba4ae0805c6dfa">ACTIVE_ROUTE_TIMEOUT</a>);
<a name="l00951"></a>00951 
<a name="l00952"></a>00952         p = <a class="code" href="NA__aodv__uu__omnet_8cc.html#aad0b14ba05f9ee915178379bee41ab47">pkt_encapsulate</a>(p, *gateWayAddress);
<a name="l00953"></a>00953 
<a name="l00954"></a>00954         <span class="keywordflow">if</span> (p == NULL)
<a name="l00955"></a>00955         {
<a name="l00956"></a>00956             <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_ERR, 0, <span class="stringliteral">&quot;IP Encapsulation failed!&quot;</span>);
<a name="l00957"></a>00957             <span class="keywordflow">return</span>;
<a name="l00958"></a>00958         }
<a name="l00959"></a>00959         <span class="comment">/* Update pointers to headers */</span>
<a name="l00960"></a>00960         dest_addr.s_addr = gateWayAddress-&gt;getInt();
<a name="l00961"></a>00961         fwd_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(dest_addr);
<a name="l00962"></a>00962     }
<a name="l00963"></a>00963 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_GATEWAY */</span>
<a name="l00964"></a>00964 
<a name="l00965"></a>00965     <span class="comment">/* UPDATE TIMERS on active forward and reverse routes...  */</span>
<a name="l00966"></a>00966     <a class="code" href="NA__routing__table_8cc.html#a438604d7812eff676f0273d700177bc8">rt_table_update_route_timeouts</a>(fwd_rt, rev_rt);
<a name="l00967"></a>00967 
<a name="l00968"></a>00968     <span class="comment">/* OK, the timeouts have been updated. Now see if either: 1. The</span>
<a name="l00969"></a>00969 <span class="comment">       packet is for this node -&gt; ACCEPT. 2. The packet is not for this</span>
<a name="l00970"></a>00970 <span class="comment">       node -&gt; Send RERR (someone want&#39;s this node to forward packets</span>
<a name="l00971"></a>00971 <span class="comment">       although there is no route) or Send RREQ. */</span>
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     <span class="keywordflow">if</span> (!fwd_rt || fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#adf770fe2eec438e3758ffe905dbae208">INVALID</a> ||
<a name="l00974"></a>00974             (fwd_rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a> == 1 &amp;&amp; (fwd_rt-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a> &amp; <a class="code" href="NA__routing__table_8h.html#adcb78e3d580f80f48cb665c2cbc5c99b">RT_UNIDIR</a>)))
<a name="l00975"></a>00975     {
<a name="l00976"></a>00976 
<a name="l00977"></a>00977         <span class="comment">/* Check if the route is marked for repair or is INVALID. In</span>
<a name="l00978"></a>00978 <span class="comment">         * that case, do a route discovery. */</span>
<a name="l00979"></a>00979         <span class="keyword">struct </span>in_addr rerr_dest;
<a name="l00980"></a>00980 
<a name="l00981"></a>00981         <span class="comment">// BEGIN NA_SINKHOLE - sancale</span>
<a name="l00982"></a>00982         <span class="comment">// If the sinkhole does not know the route, it does not send RERR</span>
<a name="l00983"></a>00983         <span class="keywordflow">if</span> (sinkholeAttackIsActive) {
<a name="l00984"></a>00984             <span class="keywordflow">if</span> (sinkOnlyWhenRouteInTable == <span class="keyword">false</span>) {
<a name="l00985"></a>00985                 <a class="code" href="NA__NesgLog_8h.html#a159ca84d25a5487d8e81e4438725df19" title="LOG macro.">LOG</a> &lt;&lt; <span class="stringliteral">&quot;Sinkhole does not send RERR&quot;</span> &lt;&lt; endl;
<a name="l00986"></a>00986                 cout &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot;: Sinkhole does not send RERR &quot;</span> &lt;&lt; endl;
<a name="l00987"></a>00987                 <span class="keyword">delete</span> p;
<a name="l00988"></a>00988                 <span class="keywordflow">return</span>;
<a name="l00989"></a>00989             }
<a name="l00990"></a>00990         }
<a name="l00991"></a>00991         <span class="comment">// END NA_SINKHOLE - sancale</span>
<a name="l00992"></a>00992 
<a name="l00993"></a>00993         <span class="keywordflow">if</span> (isLocal)
<a name="l00994"></a>00994             <span class="keywordflow">goto</span> route_discovery;
<a name="l00995"></a>00995 
<a name="l00996"></a>00996         <span class="keywordflow">if</span> (fwd_rt &amp;&amp; (fwd_rt-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a> &amp; <a class="code" href="NA__routing__table_8h.html#a9be54cbcb590c1da1bae887e4fa48152">RT_REPAIR</a>))
<a name="l00997"></a>00997             <span class="keywordflow">goto</span> route_discovery;
<a name="l00998"></a>00998 
<a name="l00999"></a>00999 
<a name="l01000"></a>01000 
<a name="l01001"></a>01001         <a class="code" href="structRERR.html">RERR</a> *rerr;
<a name="l01002"></a>01002         <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0,
<a name="l01003"></a>01003               <span class="stringliteral">&quot;No route, src=%s dest=%s prev_hop=%s - DROPPING!&quot;</span>,
<a name="l01004"></a>01004               <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(src_addr), <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(dest_addr));
<a name="l01005"></a>01005         <span class="keywordflow">if</span> (fwd_rt)
<a name="l01006"></a>01006         {
<a name="l01007"></a>01007             rerr = <a class="code" href="NA__aodv__rerr_8cc.html#a5be9893b4384b027d89d7349d69fe6f4">rerr_create</a>(0, fwd_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>,fwd_rt-&gt;<a class="code" href="structrt__table.html#ad484a2b32ae10b95e9d201ee71c0a658">dest_seqno</a>);
<a name="l01008"></a>01008             <a class="code" href="NA__routing__table_8cc.html#a26317d59b04b99645fb385905635422c">rt_table_update_timeout</a>(fwd_rt, <a class="code" href="NA__params_8h.html#a649583ef8b5c7fb8211d207e7776f3f9">DELETE_PERIOD</a>);
<a name="l01009"></a>01009         }
<a name="l01010"></a>01010         <span class="keywordflow">else</span>
<a name="l01011"></a>01011             rerr = <a class="code" href="NA__aodv__rerr_8cc.html#a5be9893b4384b027d89d7349d69fe6f4">rerr_create</a>(0, dest_addr, 0);
<a name="l01012"></a>01012         <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Sending RERR to prev hop %s for unknown dest %s&quot;</span>,
<a name="l01013"></a>01013               <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(src_addr), <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(dest_addr));
<a name="l01014"></a>01014 
<a name="l01015"></a>01015         <span class="comment">/* Unicast the RERR to the source of the data transmission</span>
<a name="l01016"></a>01016 <span class="comment">         * if possible, otherwise we broadcast it. */</span>
<a name="l01017"></a>01017 
<a name="l01018"></a>01018         <span class="keywordflow">if</span> (rev_rt &amp;&amp; rev_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>)
<a name="l01019"></a>01019             rerr_dest = rev_rt-&gt;<a class="code" href="structrt__table.html#a1046410b40a5ebff3e93efd435370cb3">next_hop</a>;
<a name="l01020"></a>01020         <span class="keywordflow">else</span>
<a name="l01021"></a>01021             rerr_dest.s_addr = ManetAddress(IPv4Address(<a class="code" href="NA__defs__aodv_8h.html#a3f5378171d85f4d025988d72cb9eab3c">AODV_BROADCAST</a>));
<a name="l01022"></a>01022 
<a name="l01023"></a>01023         <a class="code" href="NA__aodv__socket_8cc.html#a40fde4bce5dbf653ef027116bcca0e7b">aodv_socket_send</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rerr, rerr_dest,<a class="code" href="NA__aodv__rerr_8h.html#a1defe1de303abc4adadc9d0e0fb02720">RERR_CALC_SIZE</a>(rerr),
<a name="l01024"></a>01024                          1, &amp;<a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(ifindex));
<a name="l01025"></a>01025         <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#ae9b50005184bab60e94309c7a30c5c85">wait_on_reboot</a>)
<a name="l01026"></a>01026         {
<a name="l01027"></a>01027             <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;Wait on reboot timer reset.&quot;</span>);
<a name="l01028"></a>01028             <a class="code" href="NA__timer__queue__aodv_8cc.html#ace41c2dc22720e5daac03344ac0a4102">timer_set_timeout</a>(&amp;<a class="code" href="main_8c.html#a102638bbe37dfc0788ddc7de6afbffe5">worb_timer</a>, <a class="code" href="NA__params_8h.html#a649583ef8b5c7fb8211d207e7776f3f9">DELETE_PERIOD</a>);
<a name="l01029"></a>01029         }
<a name="l01030"></a>01030 
<a name="l01031"></a>01031         <span class="comment">//drop (p);</span>
<a name="l01032"></a>01032         sendICMP(p);
<a name="l01033"></a>01033         <span class="comment">/* DEBUG(LOG_DEBUG, 0, &quot;Dropping pkt uid=%d&quot;, ch-&gt;uid()); */</span>
<a name="l01034"></a>01034         <span class="comment">//  icmpAccess.get()-&gt;sendErrorMessage(p, ICMP_DESTINATION_UNREACHABLE, 0);</span>
<a name="l01035"></a>01035         <span class="keywordflow">return</span>;
<a name="l01036"></a>01036 
<a name="l01037"></a>01037 route_discovery:
<a name="l01038"></a>01038         <span class="comment">/* Buffer packets... Packets are queued by the ip_queue.o</span>
<a name="l01039"></a>01039 <span class="comment">           module already. We only need to save the handle id, and</span>
<a name="l01040"></a>01040 <span class="comment">           return the proper verdict when we know what to do... */</span>
<a name="l01041"></a>01041 
<a name="l01042"></a>01042         <a class="code" href="NA__packet__queue__omnet_8cc.html#abca7137accdfd65a117cc2df8a1cec70">packet_queue_add</a>(p, dest_addr);
<a name="l01043"></a>01043 
<a name="l01044"></a>01044         <span class="keywordflow">if</span> (fwd_rt &amp;&amp; (fwd_rt-&gt;<a class="code" href="structrt__table.html#a8eb483787e5405f1243e2a29458bd30d">flags</a> &amp; <a class="code" href="NA__routing__table_8h.html#a9be54cbcb590c1da1bae887e4fa48152">RT_REPAIR</a>))
<a name="l01045"></a>01045             <a class="code" href="NA__aodv__rreq_8cc.html#a44f18f90d4862d93f99c2b197ba61fa3">rreq_local_repair</a>(fwd_rt, src_addr, ipd);
<a name="l01046"></a>01046         <span class="keywordflow">else</span>
<a name="l01047"></a>01047             <a class="code" href="NA__aodv__rreq_8cc.html#acd5f5a4e8e1989bcf8b4612642c126a9">rreq_route_discovery</a>(dest_addr, rreq_flags, ipd);
<a name="l01048"></a>01048 
<a name="l01049"></a>01049         <span class="keywordflow">return</span>;
<a name="l01050"></a>01050 
<a name="l01051"></a>01051     }
<a name="l01052"></a>01052     <span class="keywordflow">else</span>
<a name="l01053"></a>01053     {
<a name="l01054"></a>01054         <span class="comment">/* DEBUG(LOG_DEBUG, 0, &quot;Sending pkt uid=%d&quot;, ch-&gt;uid()); */</span>
<a name="l01055"></a>01055         send(p,<span class="stringliteral">&quot;to_ip&quot;</span>);
<a name="l01056"></a>01056         <span class="comment">/* When forwarding data, make sure we are sending HELLO messages */</span>
<a name="l01057"></a>01057         gettimeofday(&amp;<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#a0685a8df41c78308172736070f16bcfa">fwd_time</a>, NULL);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059         <span class="keywordflow">if</span> (!<a class="code" href="main_8c.html#a20ce58c799d3953a9d57e6c3f8910633">llfeedback</a> &amp;&amp; <a class="code" href="main_8c.html#aff2e4196aa2a66f42a9688b5dde5cbd8">optimized_hellos</a>)
<a name="l01060"></a>01060             <a class="code" href="NA__aodv__hello_8cc.html#ab6bcab8fcfe60a3dfdb059c4f96c402b">hello_start</a>();
<a name="l01061"></a>01061     }
<a name="l01062"></a>01062 }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064 
<a name="l01065"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a3c7ed6fe3d35fb4ca17caabbf688796d">01065</a> <span class="keyword">struct </span><a class="code" href="structdev__info.html">dev_info</a> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a3c7ed6fe3d35fb4ca17caabbf688796d">dev_ifindex</a> (int <a class="code" href="structdev__info.html#a30b90665688fc12ec5b54d833215d798">ifindex</a>)
<a name="l01066"></a>01066 {
<a name="l01067"></a>01067     <span class="keywordtype">int</span> index = <a class="code" href="NA__aodv__uu__omnet_8cc.html#a91edd642776bfe21bd48c985b2b28cc7">ifindex2devindex</a>(<a class="code" href="structdev__info.html#a30b90665688fc12ec5b54d833215d798">ifindex</a>);
<a name="l01068"></a>01068     <span class="keywordflow">return</span>  (<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#af325a2d90f432c9fce1e19488e6b71bf">devs</a>[index]);
<a name="l01069"></a>01069 }
<a name="l01070"></a>01070 
<a name="l01071"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a29553947f06ffddd51f64b1d8aaea93a">01071</a> <span class="keyword">struct </span><a class="code" href="structdev__info.html">dev_info</a> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a29553947f06ffddd51f64b1d8aaea93a">dev_nr</a>(int n)
<a name="l01072"></a>01072 {
<a name="l01073"></a>01073     <span class="keywordflow">return</span> (<a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#af325a2d90f432c9fce1e19488e6b71bf">devs</a>[n]);
<a name="l01074"></a>01074 }
<a name="l01075"></a>01075 
<a name="l01076"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a91edd642776bfe21bd48c985b2b28cc7">01076</a> <span class="keywordtype">int</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a91edd642776bfe21bd48c985b2b28cc7">ifindex2devindex</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ifindex)
<a name="l01077"></a>01077 {
<a name="l01078"></a>01078     <span class="keywordtype">int</span> i;
<a name="l01079"></a>01079     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="NA__defs__aodv_8h.html#aee5b14001664d0aca9bb3c0c04fc8204">this_host</a>.<a class="code" href="structhost__info.html#aac008fcec2a6f263cdb7a328a1677a62">nif</a>; i++)
<a name="l01080"></a>01080         <span class="keywordflow">if</span> (<a class="code" href="NA__defs__aodv_8h.html#aadc3440bff34bbc102e29a41aa256e18">dev_indices</a>[i] == ifindex)
<a name="l01081"></a>01081             <span class="keywordflow">return</span> i;
<a name="l01082"></a>01082     <span class="keywordflow">return</span> -1;
<a name="l01083"></a>01083 }
<a name="l01084"></a>01084 
<a name="l01085"></a>01085 
<a name="l01086"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a10b108f7dc7dc50e3af3457f4448cc65">01086</a> <span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a10b108f7dc7dc50e3af3457f4448cc65">processLinkBreak</a>(<span class="keyword">const</span> cPolymorphic *details)
<a name="l01087"></a>01087 {
<a name="l01088"></a>01088     IPv4Datagram  *dgram=NULL;
<a name="l01089"></a>01089     <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a20ce58c799d3953a9d57e6c3f8910633">llfeedback</a>)
<a name="l01090"></a>01090     {
<a name="l01091"></a>01091         <span class="keywordflow">if</span> (dynamic_cast&lt;IPv4Datagram *&gt;(const_cast&lt;cPolymorphic*&gt; (details)))
<a name="l01092"></a>01092         {
<a name="l01093"></a>01093             dgram = check_and_cast&lt;IPv4Datagram *&gt;(details);
<a name="l01094"></a>01094             <a class="code" href="NA__aodv__uu__omnet_8cc.html#ae281ab89be96795d96ef568ad395a7c5">packetFailed</a>(dgram);
<a name="l01095"></a>01095             <span class="keywordflow">return</span>;
<a name="l01096"></a>01096         }
<a name="l01097"></a>01097         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dynamic_cast&lt;Ieee80211DataFrame *&gt;(const_cast&lt;cPolymorphic*&gt; (details)))
<a name="l01098"></a>01098         {
<a name="l01099"></a>01099             Ieee80211DataFrame *frame = <span class="keyword">dynamic_cast&lt;</span>Ieee80211DataFrame *<span class="keyword">&gt;</span>(<span class="keyword">const_cast&lt;</span>cPolymorphic*<span class="keyword">&gt;</span>(details));
<a name="l01100"></a>01100             <a class="code" href="NA__aodv__uu__omnet_8cc.html#a719e65d72818a3b33a6178fad4a13821">packetFailedMac</a>(frame);
<a name="l01101"></a>01101         }
<a name="l01102"></a>01102     }
<a name="l01103"></a>01103 }
<a name="l01104"></a>01104 
<a name="l01105"></a>01105 
<a name="l01106"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a57ae8fc573fb73b2c8faa4e7fa597567">01106</a> <span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a57ae8fc573fb73b2c8faa4e7fa597567">finish</a>()
<a name="l01107"></a>01107 {
<a name="l01108"></a>01108 
<a name="l01109"></a>01109     simtime_t t = simTime();
<a name="l01110"></a>01110     <span class="keywordflow">if</span> (t==0)
<a name="l01111"></a>01111         <span class="keywordflow">return</span>;
<a name="l01112"></a>01112     <span class="keywordflow">if</span> (iswrite)
<a name="l01113"></a>01113         <span class="keywordflow">return</span>;
<a name="l01114"></a>01114     iswrite=<span class="keyword">true</span>;
<a name="l01115"></a>01115     recordScalar(<span class="stringliteral">&quot;simulated time&quot;</span>, t);
<a name="l01116"></a>01116     recordScalar(<span class="stringliteral">&quot;Aodv totalSend &quot;</span>, totalSend);
<a name="l01117"></a>01117     recordScalar(<span class="stringliteral">&quot;rreq send&quot;</span>, totalRreqSend);
<a name="l01118"></a>01118     recordScalar(<span class="stringliteral">&quot;rreq rec&quot;</span>, totalRreqRec);
<a name="l01119"></a>01119     recordScalar(<span class="stringliteral">&quot;rrep send&quot;</span>, totalRrepSend);
<a name="l01120"></a>01120     recordScalar(<span class="stringliteral">&quot;rrep rec&quot;</span>, totalRrepRec);
<a name="l01121"></a>01121     recordScalar(<span class="stringliteral">&quot;rrep ack send&quot;</span>, totalRrepAckSend);
<a name="l01122"></a>01122     recordScalar(<span class="stringliteral">&quot;rrep ack rec&quot;</span>, totalRrepAckRec);
<a name="l01123"></a>01123     recordScalar(<span class="stringliteral">&quot;rerr send&quot;</span>, totalRerrSend);
<a name="l01124"></a>01124     recordScalar(<span class="stringliteral">&quot;rerr rec&quot;</span>, totalRerrRec);
<a name="l01125"></a>01125 }
<a name="l01126"></a>01126 
<a name="l01127"></a>01127 
<a name="l01128"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a31a79a067c7b48d2e495e9354700ea2d">01128</a> uint32_t <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a31a79a067c7b48d2e495e9354700ea2d">getRoute</a>(<span class="keyword">const</span> ManetAddress &amp;dest,std::vector&lt;ManetAddress&gt; &amp;add)
<a name="l01129"></a>01129 {
<a name="l01130"></a>01130     <span class="keywordflow">return</span> 0;
<a name="l01131"></a>01131 }
<a name="l01132"></a>01132 
<a name="l01133"></a>01133 
<a name="l01134"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a8eff244afd75cbd50bf9f544115467b6">01134</a> <span class="keywordtype">bool</span>  <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a8eff244afd75cbd50bf9f544115467b6">getNextHop</a>(<span class="keyword">const</span> ManetAddress &amp;dest,ManetAddress &amp;add, <span class="keywordtype">int</span> &amp;iface,<span class="keywordtype">double</span> &amp;cost)
<a name="l01135"></a>01135 {
<a name="l01136"></a>01136     <span class="keyword">struct </span>in_addr destAddr;
<a name="l01137"></a>01137     destAddr.s_addr = dest;
<a name="l01138"></a>01138     ManetAddress apAddr;
<a name="l01139"></a>01139     <a class="code" href="structrt__table.html">rt_table_t</a> * fwd_rt = this-&gt;<a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(destAddr);
<a name="l01140"></a>01140     <span class="keywordflow">if</span> (fwd_rt)
<a name="l01141"></a>01141     {
<a name="l01142"></a>01142         <span class="keywordflow">if</span> (fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> != <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>)
<a name="l01143"></a>01143             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01144"></a>01144         add = fwd_rt-&gt;<a class="code" href="structrt__table.html#a1046410b40a5ebff3e93efd435370cb3">next_hop</a>.s_addr;
<a name="l01145"></a>01145         InterfaceEntry * ie = getInterfaceEntry (fwd_rt-&gt;<a class="code" href="structrt__table.html#a665abe74b795976e9dffc9d1c3a586b2">ifindex</a>);
<a name="l01146"></a>01146         iface = ie-&gt;getInterfaceId();
<a name="l01147"></a>01147         cost = fwd_rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a>;
<a name="l01148"></a>01148         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01149"></a>01149     }
<a name="l01150"></a>01150     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (getAp(dest,apAddr))
<a name="l01151"></a>01151     {
<a name="l01152"></a>01152         destAddr.s_addr = apAddr;
<a name="l01153"></a>01153         fwd_rt = this-&gt;<a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(destAddr);
<a name="l01154"></a>01154         <span class="keywordflow">if</span> (!fwd_rt)
<a name="l01155"></a>01155             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01156"></a>01156         <span class="keywordflow">if</span> (fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> != <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>)
<a name="l01157"></a>01157             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01158"></a>01158         add = fwd_rt-&gt;<a class="code" href="structrt__table.html#a1046410b40a5ebff3e93efd435370cb3">next_hop</a>.s_addr;
<a name="l01159"></a>01159         InterfaceEntry * ie = getInterfaceEntry (fwd_rt-&gt;<a class="code" href="structrt__table.html#a665abe74b795976e9dffc9d1c3a586b2">ifindex</a>);
<a name="l01160"></a>01160         iface = ie-&gt;getInterfaceId();
<a name="l01161"></a>01161         cost = fwd_rt-&gt;<a class="code" href="structrt__table.html#aba34d8b3ef7e7556aa19d832770abe7f">hcnt</a>;
<a name="l01162"></a>01162         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01163"></a>01163     }
<a name="l01164"></a>01164     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01165"></a>01165 }
<a name="l01166"></a>01166 
<a name="l01167"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#aa64e11afca6cda15e3bf8be1864ca317">01167</a> <span class="keywordtype">bool</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#aa64e11afca6cda15e3bf8be1864ca317">isProactive</a>()
<a name="l01168"></a>01168 {
<a name="l01169"></a>01169     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01170"></a>01170 }
<a name="l01171"></a>01171 
<a name="l01172"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a877aca5e8d2deb5b3ed4a3b14bde93ca">01172</a> <span class="keywordtype">void</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a877aca5e8d2deb5b3ed4a3b14bde93ca">setRefreshRoute</a>(<span class="keyword">const</span> ManetAddress &amp;destination, <span class="keyword">const</span> ManetAddress &amp; nextHop,<span class="keywordtype">bool</span> isReverse)
<a name="l01173"></a>01173 {
<a name="l01174"></a>01174     <span class="keyword">struct </span>in_addr dest_addr, next_hop;
<a name="l01175"></a>01175     dest_addr.s_addr = destination;
<a name="l01176"></a>01176     next_hop.s_addr = nextHop;
<a name="l01177"></a>01177     <a class="code" href="structrt__table.html">rt_table_t</a> * route  = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(dest_addr);
<a name="l01178"></a>01178 
<a name="l01179"></a>01179     <span class="keywordflow">if</span>(par (<span class="stringliteral">&quot;checkNextHop&quot;</span>).boolValue())
<a name="l01180"></a>01180     {
<a name="l01181"></a>01181         <span class="keywordflow">if</span> (nextHop.isUnspecified())
<a name="l01182"></a>01182            <span class="keywordflow">return</span>;
<a name="l01183"></a>01183         <span class="keywordflow">if</span> (!isReverse)
<a name="l01184"></a>01184         {
<a name="l01185"></a>01185             <span class="keywordflow">if</span> (route &amp;&amp;(route-&gt;<a class="code" href="structrt__table.html#a1046410b40a5ebff3e93efd435370cb3">next_hop</a>.s_addr==nextHop))
<a name="l01186"></a>01186                  <a class="code" href="NA__routing__table_8cc.html#a438604d7812eff676f0273d700177bc8">rt_table_update_route_timeouts</a>(route, NULL);
<a name="l01187"></a>01187         }
<a name="l01188"></a>01188 
<a name="l01189"></a>01189 
<a name="l01190"></a>01190         <span class="keywordflow">if</span> (isReverse &amp;&amp; !route)
<a name="l01191"></a>01191         {
<a name="l01192"></a>01192             <span class="comment">// Gratuitous Return Path</span>
<a name="l01193"></a>01193             <span class="keyword">struct </span>in_addr node_addr;
<a name="l01194"></a>01194             <span class="keyword">struct </span>in_addr  ip_src;
<a name="l01195"></a>01195             node_addr.s_addr = destination;
<a name="l01196"></a>01196             ip_src.s_addr = nextHop;
<a name="l01197"></a>01197             <a class="code" href="NA__routing__table_8cc.html#aa2ab023febf342ee9ac01a344ebd4e50">rt_table_insert</a>(node_addr, ip_src,0,0, <a class="code" href="NA__params_8h.html#aba91511b61e5a1a42aba4ae0805c6dfa">ACTIVE_ROUTE_TIMEOUT</a>, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>, 0,NS_DEV_NR,0xFFFFFFF,100);
<a name="l01198"></a>01198         }
<a name="l01199"></a>01199         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (route &amp;&amp; (route-&gt;<a class="code" href="structrt__table.html#a1046410b40a5ebff3e93efd435370cb3">next_hop</a>.s_addr==nextHop))
<a name="l01200"></a>01200             <a class="code" href="NA__routing__table_8cc.html#a438604d7812eff676f0273d700177bc8">rt_table_update_route_timeouts</a>(NULL, route);
<a name="l01201"></a>01201 
<a name="l01202"></a>01202     }
<a name="l01203"></a>01203     <span class="keywordflow">else</span>
<a name="l01204"></a>01204     {
<a name="l01205"></a>01205         <span class="keywordflow">if</span> (!isReverse)
<a name="l01206"></a>01206         {
<a name="l01207"></a>01207             <span class="keywordflow">if</span> (route)
<a name="l01208"></a>01208                  <a class="code" href="NA__routing__table_8cc.html#a438604d7812eff676f0273d700177bc8">rt_table_update_route_timeouts</a>(route, NULL);
<a name="l01209"></a>01209         }
<a name="l01210"></a>01210 
<a name="l01211"></a>01211 
<a name="l01212"></a>01212         <span class="keywordflow">if</span> (isReverse &amp;&amp; !route &amp;&amp; !nextHop.isUnspecified())
<a name="l01213"></a>01213         {
<a name="l01214"></a>01214             <span class="comment">// Gratuitous Return Path</span>
<a name="l01215"></a>01215             <span class="keyword">struct </span>in_addr node_addr;
<a name="l01216"></a>01216             <span class="keyword">struct </span>in_addr  ip_src;
<a name="l01217"></a>01217             node_addr.s_addr = destination;
<a name="l01218"></a>01218             ip_src.s_addr = nextHop;
<a name="l01219"></a>01219             <a class="code" href="NA__routing__table_8cc.html#aa2ab023febf342ee9ac01a344ebd4e50">rt_table_insert</a>(node_addr, ip_src,0,0, <a class="code" href="NA__params_8h.html#aba91511b61e5a1a42aba4ae0805c6dfa">ACTIVE_ROUTE_TIMEOUT</a>, <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a>, 0,NS_DEV_NR,0xFFFFFFF,100);
<a name="l01220"></a>01220         }
<a name="l01221"></a>01221         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (route)
<a name="l01222"></a>01222             <a class="code" href="NA__routing__table_8cc.html#a438604d7812eff676f0273d700177bc8">rt_table_update_route_timeouts</a>(NULL, route);
<a name="l01223"></a>01223 
<a name="l01224"></a>01224     }
<a name="l01225"></a>01225 
<a name="l01226"></a>01226     Enter_Method_Silent();
<a name="l01227"></a>01227     <a class="code" href="NA__aodv__uu__omnet_8cc.html#a729fbf9488031301b67264c1531da6a5">scheduleNextEvent</a>();
<a name="l01228"></a>01228 }
<a name="l01229"></a>01229 
<a name="l01230"></a>01230 
<a name="l01231"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#ae355e1c1c774a2f54c6896f1a0f865f5">01231</a> <span class="keywordtype">bool</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#ae355e1c1c774a2f54c6896f1a0f865f5">isOurType</a>(cPacket * msg)
<a name="l01232"></a>01232 {
<a name="l01233"></a>01233     <a class="code" href="structAODV__msg.html">AODV_msg</a> *re = dynamic_cast &lt;<a class="code" href="structAODV__msg.html">AODV_msg</a> *&gt;(msg);
<a name="l01234"></a>01234     <span class="keywordflow">if</span> (re)
<a name="l01235"></a>01235         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01236"></a>01236     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01237"></a>01237 }
<a name="l01238"></a>01238 
<a name="l01239"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a040bef6d7b1aa50d41a50f2bb87cc418">01239</a> <span class="keywordtype">bool</span> <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a040bef6d7b1aa50d41a50f2bb87cc418">getDestAddress</a>(cPacket *msg,ManetAddress &amp;dest)
<a name="l01240"></a>01240 {
<a name="l01241"></a>01241     <a class="code" href="structRREQ.html">RREQ</a> *rreq = dynamic_cast &lt;<a class="code" href="structRREQ.html">RREQ</a> *&gt;(msg);
<a name="l01242"></a>01242     <span class="keywordflow">if</span> (!rreq)
<a name="l01243"></a>01243         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01244"></a>01244     dest = rreq-&gt;<a class="code" href="structRREQ.html#a45d9523cee3586f9529f7a8035a3639e">dest_addr</a>;
<a name="l01245"></a>01245     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01246"></a>01246 
<a name="l01247"></a>01247 }
<a name="l01248"></a>01248 <span class="preprocessor">#ifdef AODV_USE_STL_RT</span>
<a name="l01249"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a02b4c17f3b5f244a29321bf62e72fe66">01249</a> <span class="preprocessor"></span><span class="keywordtype">bool</span>  <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a02b4c17f3b5f244a29321bf62e72fe66">setRoute</a>(<span class="keyword">const</span> ManetAddress &amp;dest,<span class="keyword">const</span> ManetAddress &amp;add, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;ifaceIndex,<span class="keyword">const</span> <span class="keywordtype">int</span> &amp;hops,<span class="keyword">const</span> ManetAddress &amp;mask)
<a name="l01250"></a>01250 {
<a name="l01251"></a>01251     Enter_Method_Silent();
<a name="l01252"></a>01252     <span class="keyword">struct </span>in_addr destAddr;
<a name="l01253"></a>01253     <span class="keyword">struct </span>in_addr nextAddr;
<a name="l01254"></a>01254     <span class="keyword">struct </span>in_addr rerr_dest;
<a name="l01255"></a>01255     destAddr.s_addr = dest;
<a name="l01256"></a>01256     nextAddr.s_addr = add;
<a name="l01257"></a>01257     <span class="keywordtype">bool</span> status=<span class="keyword">true</span>;
<a name="l01258"></a>01258     <span class="keywordtype">bool</span> delEntry = add.isUnspecified();
<a name="l01259"></a>01259 
<a name="l01260"></a>01260     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;setRoute %s next hop %s&quot;</span>,<a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(destAddr),<a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(nextAddr));
<a name="l01261"></a>01261 
<a name="l01262"></a>01262     <a class="code" href="structrt__table.html">rt_table_t</a> * fwd_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(destAddr);
<a name="l01263"></a>01263 
<a name="l01264"></a>01264     <span class="keywordflow">if</span> (fwd_rt)
<a name="l01265"></a>01265     {
<a name="l01266"></a>01266         <span class="keywordflow">if</span> (delEntry)
<a name="l01267"></a>01267         {
<a name="l01268"></a>01268             <a class="code" href="structRERR.html">RERR</a>* rerr = <a class="code" href="NA__aodv__rerr_8cc.html#a5be9893b4384b027d89d7349d69fe6f4">rerr_create</a>(0, destAddr, 0);
<a name="l01269"></a>01269             <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;setRoute Sending for unknown dest %s&quot;</span>, <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(destAddr));
<a name="l01270"></a>01270 
<a name="l01271"></a>01271             <span class="comment">/* Unicast the RERR to the source of the data transmission</span>
<a name="l01272"></a>01272 <span class="comment">             * if possible, otherwise we broadcast it. */</span>
<a name="l01273"></a>01273             rerr_dest.s_addr = ManetAddress(IPv4Address(<a class="code" href="NA__defs__aodv_8h.html#a3f5378171d85f4d025988d72cb9eab3c">AODV_BROADCAST</a>));
<a name="l01274"></a>01274 
<a name="l01275"></a>01275             <a class="code" href="NA__aodv__socket_8cc.html#a40fde4bce5dbf653ef027116bcca0e7b">aodv_socket_send</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rerr, rerr_dest,<a class="code" href="NA__aodv__rerr_8h.html#a1defe1de303abc4adadc9d0e0fb02720">RERR_CALC_SIZE</a>(rerr),
<a name="l01276"></a>01276                              1, &amp;<a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(NS_IFINDEX));
<a name="l01277"></a>01277         }
<a name="l01278"></a>01278         ManetAddress dest = fwd_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>.s_addr;
<a name="l01279"></a>01279         AodvRtTableMap::iterator it = aodvRtTableMap.find(dest);
<a name="l01280"></a>01280         <span class="keywordflow">if</span> (it != aodvRtTableMap.end())
<a name="l01281"></a>01281         {
<a name="l01282"></a>01282             <span class="keywordflow">if</span> (it-&gt;second != fwd_rt)
<a name="l01283"></a>01283                 opp_error(<span class="stringliteral">&quot;AODV routing table error&quot;</span>);
<a name="l01284"></a>01284         }
<a name="l01285"></a>01285         aodvRtTableMap.erase(it);
<a name="l01286"></a>01286         <span class="keywordflow">if</span> (fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a> || fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>)
<a name="l01287"></a>01287             <a class="code" href="NA__routing__table_8h.html#a56f12e70a7c6b6382f18390882a4efa3">rt_tbl</a>.<a class="code" href="structrouting__table.html#a3c6303b4e2dfb9422d985d3a6200c178">num_active</a>--;
<a name="l01288"></a>01288         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a3c6af9d87e4429f83b6ffff58f860252">rt_timer</a>);
<a name="l01289"></a>01289         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a56aadfd52f29b6ca3bece47474dd4ca8">hello_timer</a>);
<a name="l01290"></a>01290         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a4b5c6baab186ae8733b48cf2d5172852">ack_timer</a>);
<a name="l01291"></a>01291         <a class="code" href="NA__routing__table_8h.html#a56f12e70a7c6b6382f18390882a4efa3">rt_tbl</a>.<a class="code" href="structrouting__table.html#a7125a62fc2021951e4effe615a892fd9">num_entries</a> = aodvRtTableMap.size();
<a name="l01292"></a>01292         free (fwd_rt);
<a name="l01293"></a>01293     }
<a name="l01294"></a>01294     <span class="keywordflow">else</span>
<a name="l01295"></a>01295         <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;No route entry to delete&quot;</span>);
<a name="l01296"></a>01296 
<a name="l01297"></a>01297     <span class="keywordflow">if</span> (ifaceIndex&gt;=getNumInterfaces())
<a name="l01298"></a>01298         status = <span class="keyword">false</span>;
<a name="l01299"></a>01299     <a class="code" href="NA__aodv__uu__omnet_8cc.html#a02b4c17f3b5f244a29321bf62e72fe66">ManetRoutingBase::setRoute</a>(dest,add,ifaceIndex,hops,mask);
<a name="l01300"></a>01300 
<a name="l01301"></a>01301     <span class="keywordflow">if</span> (!delEntry &amp;&amp; ifaceIndex&lt;getNumInterfaces())
<a name="l01302"></a>01302     {
<a name="l01303"></a>01303         fwd_rt = <a class="code" href="NA__routing__table_8cc.html#ac1648cf2755eba3487d843755d0bd653">modifyAODVTables</a>(destAddr,nextAddr,hops,(uint32_t) SIMTIME_DBL(simTime()), 0xFFFF,<a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>,0, ifaceIndex);
<a name="l01304"></a>01304         status = (fwd_rt!=NULL);
<a name="l01305"></a>01305 
<a name="l01306"></a>01306     }
<a name="l01307"></a>01307 
<a name="l01308"></a>01308     <span class="keywordflow">return</span> status;
<a name="l01309"></a>01309 }
<a name="l01310"></a>01310 
<a name="l01311"></a>01311 
<a name="l01312"></a><a class="code" href="NA__aodv__uu__omnet_8cc.html#a2638e88e0ea331164577605d09171491">01312</a> <span class="keywordtype">bool</span>  <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a02b4c17f3b5f244a29321bf62e72fe66">setRoute</a>(<span class="keyword">const</span> ManetAddress &amp;dest,<span class="keyword">const</span> ManetAddress &amp;add, <span class="keyword">const</span> <span class="keywordtype">char</span>  *ifaceName,<span class="keyword">const</span> <span class="keywordtype">int</span> &amp;hops,<span class="keyword">const</span> ManetAddress &amp;mask)
<a name="l01313"></a>01313 {
<a name="l01314"></a>01314     Enter_Method_Silent();
<a name="l01315"></a>01315     <span class="keyword">struct </span>in_addr destAddr;
<a name="l01316"></a>01316     <span class="keyword">struct </span>in_addr nextAddr;
<a name="l01317"></a>01317     <span class="keyword">struct </span>in_addr rerr_dest;
<a name="l01318"></a>01318     destAddr.s_addr = dest;
<a name="l01319"></a>01319     nextAddr.s_addr = add;
<a name="l01320"></a>01320     <span class="keywordtype">bool</span> status=<span class="keyword">true</span>;
<a name="l01321"></a>01321     <span class="keywordtype">int</span> index;
<a name="l01322"></a>01322     <span class="keywordtype">bool</span> delEntry = add.isUnspecified();
<a name="l01323"></a>01323 
<a name="l01324"></a>01324     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;setRoute %s next hop %s&quot;</span>,<a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(destAddr),<a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(nextAddr));
<a name="l01325"></a>01325     <a class="code" href="structrt__table.html">rt_table_t</a> * fwd_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(destAddr);
<a name="l01326"></a>01326 
<a name="l01327"></a>01327     <span class="keywordflow">if</span> (fwd_rt)
<a name="l01328"></a>01328     {
<a name="l01329"></a>01329         <span class="keywordflow">if</span> (delEntry)
<a name="l01330"></a>01330         {
<a name="l01331"></a>01331             <a class="code" href="structRERR.html">RERR</a>* rerr = <a class="code" href="NA__aodv__rerr_8cc.html#a5be9893b4384b027d89d7349d69fe6f4">rerr_create</a>(0, destAddr, 0);
<a name="l01332"></a>01332             <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;setRoute Sending for unknown dest %s&quot;</span>, <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(destAddr));
<a name="l01333"></a>01333 
<a name="l01334"></a>01334             <span class="comment">/* Unicast the RERR to the source of the data transmission</span>
<a name="l01335"></a>01335 <span class="comment">             * if possible, otherwise we broadcast it. */</span>
<a name="l01336"></a>01336             rerr_dest.s_addr = ManetAddress(IPv4Address(<a class="code" href="NA__defs__aodv_8h.html#a3f5378171d85f4d025988d72cb9eab3c">AODV_BROADCAST</a>));
<a name="l01337"></a>01337 
<a name="l01338"></a>01338             <a class="code" href="NA__aodv__socket_8cc.html#a40fde4bce5dbf653ef027116bcca0e7b">aodv_socket_send</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rerr, rerr_dest,<a class="code" href="NA__aodv__rerr_8h.html#a1defe1de303abc4adadc9d0e0fb02720">RERR_CALC_SIZE</a>(rerr),
<a name="l01339"></a>01339                              1, &amp;<a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(NS_IFINDEX));
<a name="l01340"></a>01340         }
<a name="l01341"></a>01341         ManetAddress dest = fwd_rt-&gt;<a class="code" href="structrt__table.html#ac480e49c5adabc5b6bbb5f18386c8de5">dest_addr</a>.s_addr;
<a name="l01342"></a>01342         AodvRtTableMap::iterator it = aodvRtTableMap.find(dest);
<a name="l01343"></a>01343         <span class="keywordflow">if</span> (it != aodvRtTableMap.end())
<a name="l01344"></a>01344         {
<a name="l01345"></a>01345             <span class="keywordflow">if</span> (it-&gt;second != fwd_rt)
<a name="l01346"></a>01346                 opp_error(<span class="stringliteral">&quot;AODV routing table error&quot;</span>);
<a name="l01347"></a>01347         }
<a name="l01348"></a>01348         aodvRtTableMap.erase(it);
<a name="l01349"></a>01349         <span class="keywordflow">if</span> (fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a> || fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>)
<a name="l01350"></a>01350             <a class="code" href="NA__routing__table_8h.html#a56f12e70a7c6b6382f18390882a4efa3">rt_tbl</a>.<a class="code" href="structrouting__table.html#a3c6303b4e2dfb9422d985d3a6200c178">num_active</a>--;
<a name="l01351"></a>01351         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a3c6af9d87e4429f83b6ffff58f860252">rt_timer</a>);
<a name="l01352"></a>01352         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a56aadfd52f29b6ca3bece47474dd4ca8">hello_timer</a>);
<a name="l01353"></a>01353         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a4b5c6baab186ae8733b48cf2d5172852">ack_timer</a>);
<a name="l01354"></a>01354         <a class="code" href="NA__routing__table_8h.html#a56f12e70a7c6b6382f18390882a4efa3">rt_tbl</a>.<a class="code" href="structrouting__table.html#a7125a62fc2021951e4effe615a892fd9">num_entries</a> = aodvRtTableMap.size();
<a name="l01355"></a>01355         free (fwd_rt);
<a name="l01356"></a>01356     }
<a name="l01357"></a>01357     <span class="keywordflow">else</span>
<a name="l01358"></a>01358         <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;No route entry to delete&quot;</span>);
<a name="l01359"></a>01359 
<a name="l01360"></a>01360     <span class="keywordflow">for</span> (index = 0; index &lt;getNumInterfaces(); index++)
<a name="l01361"></a>01361     {
<a name="l01362"></a>01362         <span class="keywordflow">if</span> (strcmp(ifaceName, getInterfaceEntry(index)-&gt;<a class="code" href="utilidades_8cc.html#af5b5c4787ffe48b5c4fc01aea42cd1c4">getName</a>())==0) <span class="keywordflow">break</span>;
<a name="l01363"></a>01363     }
<a name="l01364"></a>01364     <span class="keywordflow">if</span> (index&gt;=getNumInterfaces())
<a name="l01365"></a>01365         status = <span class="keyword">false</span>;
<a name="l01366"></a>01366 
<a name="l01367"></a>01367     <a class="code" href="NA__aodv__uu__omnet_8cc.html#a02b4c17f3b5f244a29321bf62e72fe66">ManetRoutingBase::setRoute</a>(dest,add,index,hops,mask);
<a name="l01368"></a>01368 
<a name="l01369"></a>01369     <span class="keywordflow">if</span> (!delEntry &amp;&amp; index&lt;getNumInterfaces())
<a name="l01370"></a>01370     {
<a name="l01371"></a>01371         fwd_rt = <a class="code" href="NA__routing__table_8cc.html#ac1648cf2755eba3487d843755d0bd653">modifyAODVTables</a>(destAddr,nextAddr,hops,(uint32_t) SIMTIME_DBL(simTime()), 0xFFFF,<a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>,0, index);
<a name="l01372"></a>01372         status = (fwd_rt!=NULL);
<a name="l01373"></a>01373     }
<a name="l01374"></a>01374 
<a name="l01375"></a>01375 
<a name="l01376"></a>01376     <span class="keywordflow">return</span> status;
<a name="l01377"></a>01377 }
<a name="l01378"></a>01378 <span class="preprocessor">#else</span>
<a name="l01379"></a>01379 <span class="preprocessor"></span>
<a name="l01380"></a>01380 <span class="keywordtype">bool</span>  <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a02b4c17f3b5f244a29321bf62e72fe66">setRoute</a>(<span class="keyword">const</span> ManetAddress &amp;dest,<span class="keyword">const</span> ManetAddress &amp;add, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;ifaceIndex,<span class="keyword">const</span> <span class="keywordtype">int</span> &amp;hops,<span class="keyword">const</span> ManetAddress &amp;mask)
<a name="l01381"></a>01381 {
<a name="l01382"></a>01382     Enter_Method_Silent();
<a name="l01383"></a>01383     <span class="keyword">struct </span>in_addr destAddr;
<a name="l01384"></a>01384     <span class="keyword">struct </span>in_addr nextAddr;
<a name="l01385"></a>01385     <span class="keyword">struct </span>in_addr rerr_dest;
<a name="l01386"></a>01386     destAddr.s_addr = dest;
<a name="l01387"></a>01387     nextAddr.s_addr = add;
<a name="l01388"></a>01388     <span class="keywordtype">bool</span> status=<span class="keyword">true</span>;
<a name="l01389"></a>01389     <span class="keywordtype">bool</span> delEntry = (add == (ManetAddress)0);
<a name="l01390"></a>01390 
<a name="l01391"></a>01391     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;setRoute %s next hop %s&quot;</span>,<a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(destAddr),<a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(nextAddr));
<a name="l01392"></a>01392 
<a name="l01393"></a>01393     <a class="code" href="structrt__table.html">rt_table_t</a> * fwd_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(destAddr);
<a name="l01394"></a>01394 
<a name="l01395"></a>01395     <span class="keywordflow">if</span> (fwd_rt)
<a name="l01396"></a>01396     {
<a name="l01397"></a>01397         <span class="keywordflow">if</span> (delEntry)
<a name="l01398"></a>01398         {
<a name="l01399"></a>01399             <a class="code" href="structRERR.html">RERR</a>* rerr = <a class="code" href="NA__aodv__rerr_8cc.html#a5be9893b4384b027d89d7349d69fe6f4">rerr_create</a>(0, destAddr, 0);
<a name="l01400"></a>01400             <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;setRoute Sending for unknown dest %s&quot;</span>, <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(destAddr));
<a name="l01401"></a>01401 
<a name="l01402"></a>01402             <span class="comment">/* Unicast the RERR to the source of the data transmission</span>
<a name="l01403"></a>01403 <span class="comment">             * if possible, otherwise we broadcast it. */</span>
<a name="l01404"></a>01404             rerr_dest.s_addr = <a class="code" href="NA__defs__aodv_8h.html#a3f5378171d85f4d025988d72cb9eab3c">AODV_BROADCAST</a>;
<a name="l01405"></a>01405 
<a name="l01406"></a>01406             <a class="code" href="NA__aodv__socket_8cc.html#a40fde4bce5dbf653ef027116bcca0e7b">aodv_socket_send</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rerr, rerr_dest,<a class="code" href="NA__aodv__rerr_8h.html#a1defe1de303abc4adadc9d0e0fb02720">RERR_CALC_SIZE</a>(rerr),
<a name="l01407"></a>01407                              1, &amp;<a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(NS_IFINDEX));
<a name="l01408"></a>01408         }
<a name="l01409"></a>01409         <a class="code" href="NA__list_8cc.html#a95fe3a213ff2c475c79bd705a56a22cc">list_detach</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a9766df03900778ed6369aad09aeb7d43">l</a>);
<a name="l01410"></a>01410         <a class="code" href="NA__routing__table_8cc.html#a01a24c260d1ec566bcae0dc82d3867cf">precursor_list_destroy</a>(fwd_rt);
<a name="l01411"></a>01411         <span class="keywordflow">if</span> (fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a> || fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>)
<a name="l01412"></a>01412             <a class="code" href="NA__routing__table_8h.html#a56f12e70a7c6b6382f18390882a4efa3">rt_tbl</a>.<a class="code" href="structrouting__table.html#a3c6303b4e2dfb9422d985d3a6200c178">num_active</a>--;
<a name="l01413"></a>01413         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a3c6af9d87e4429f83b6ffff58f860252">rt_timer</a>);
<a name="l01414"></a>01414         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a56aadfd52f29b6ca3bece47474dd4ca8">hello_timer</a>);
<a name="l01415"></a>01415         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a4b5c6baab186ae8733b48cf2d5172852">ack_timer</a>);
<a name="l01416"></a>01416         <a class="code" href="NA__routing__table_8h.html#a56f12e70a7c6b6382f18390882a4efa3">rt_tbl</a>.<a class="code" href="structrouting__table.html#a7125a62fc2021951e4effe615a892fd9">num_entries</a>--;
<a name="l01417"></a>01417         free (fwd_rt);
<a name="l01418"></a>01418     }
<a name="l01419"></a>01419     <span class="keywordflow">else</span>
<a name="l01420"></a>01420         <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;No route entry to delete&quot;</span>);
<a name="l01421"></a>01421 
<a name="l01422"></a>01422     <span class="keywordflow">if</span> (ifaceIndex&gt;=getNumInterfaces())
<a name="l01423"></a>01423         status = <span class="keyword">false</span>;
<a name="l01424"></a>01424     <a class="code" href="NA__aodv__uu__omnet_8cc.html#a02b4c17f3b5f244a29321bf62e72fe66">ManetRoutingBase::setRoute</a>(dest,add,ifaceIndex,hops,mask);
<a name="l01425"></a>01425 
<a name="l01426"></a>01426     <span class="keywordflow">if</span> (!delEntry &amp;&amp; ifaceIndex&lt;getNumInterfaces())
<a name="l01427"></a>01427     {
<a name="l01428"></a>01428         fwd_rt = <a class="code" href="NA__routing__table_8cc.html#ac1648cf2755eba3487d843755d0bd653">modifyAODVTables</a>(destAddr,nextAddr,hops,(uint32_t) SIMTIME_DBL(simTime()), 0xFFFF,<a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>,0, ifaceIndex);
<a name="l01429"></a>01429         status = (fwd_rt!=NULL);
<a name="l01430"></a>01430 
<a name="l01431"></a>01431     }
<a name="l01432"></a>01432 
<a name="l01433"></a>01433     <span class="keywordflow">return</span> status;
<a name="l01434"></a>01434 }
<a name="l01435"></a>01435 
<a name="l01436"></a>01436 <span class="keywordtype">bool</span>  <a class="code" href="NA__defs__aodv_8h.html#a05cf0a58bc81df9625ff2581b0f8b5f3">NS_CLASS</a> <a class="code" href="NA__aodv__uu__omnet_8cc.html#a02b4c17f3b5f244a29321bf62e72fe66">setRoute</a>(<span class="keyword">const</span> ManetAddress &amp;dest,<span class="keyword">const</span> ManetAddress &amp;add, <span class="keyword">const</span> <span class="keywordtype">char</span>  *ifaceName,<span class="keyword">const</span> <span class="keywordtype">int</span> &amp;hops,<span class="keyword">const</span> ManetAddress &amp;mask)
<a name="l01437"></a>01437 {
<a name="l01438"></a>01438     Enter_Method_Silent();
<a name="l01439"></a>01439     <span class="keyword">struct </span>in_addr destAddr;
<a name="l01440"></a>01440     <span class="keyword">struct </span>in_addr nextAddr;
<a name="l01441"></a>01441     <span class="keyword">struct </span>in_addr rerr_dest;
<a name="l01442"></a>01442     destAddr.s_addr = dest;
<a name="l01443"></a>01443     nextAddr.s_addr = add;
<a name="l01444"></a>01444     <span class="keywordtype">bool</span> status=<span class="keyword">true</span>;
<a name="l01445"></a>01445     <span class="keywordtype">int</span> index;
<a name="l01446"></a>01446     <span class="keywordtype">bool</span> delEntry = (add == (ManetAddress)0);
<a name="l01447"></a>01447 
<a name="l01448"></a>01448     <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;setRoute %s next hop %s&quot;</span>,<a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(destAddr),<a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(nextAddr));
<a name="l01449"></a>01449     <a class="code" href="structrt__table.html">rt_table_t</a> * fwd_rt = <a class="code" href="NA__routing__table_8cc.html#a69302b8ba8b3ee7f9d6c43eacd4ee43c">rt_table_find</a>(destAddr);
<a name="l01450"></a>01450 
<a name="l01451"></a>01451     <span class="keywordflow">if</span> (fwd_rt)
<a name="l01452"></a>01452     {
<a name="l01453"></a>01453         <span class="keywordflow">if</span> (delEntry)
<a name="l01454"></a>01454         {
<a name="l01455"></a>01455             <a class="code" href="structRERR.html">RERR</a>* rerr = <a class="code" href="NA__aodv__rerr_8cc.html#a5be9893b4384b027d89d7349d69fe6f4">rerr_create</a>(0, destAddr, 0);
<a name="l01456"></a>01456             <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;setRoute Sending for unknown dest %s&quot;</span>, <a class="code" href="NA__debug__aodv_8cc.html#acc0381e3baeab5deb9eed755adae18bc">ip_to_str</a>(destAddr));
<a name="l01457"></a>01457 
<a name="l01458"></a>01458             <span class="comment">/* Unicast the RERR to the source of the data transmission</span>
<a name="l01459"></a>01459 <span class="comment">             * if possible, otherwise we broadcast it. */</span>
<a name="l01460"></a>01460             rerr_dest.s_addr = <a class="code" href="NA__defs__aodv_8h.html#a3f5378171d85f4d025988d72cb9eab3c">AODV_BROADCAST</a>;
<a name="l01461"></a>01461 
<a name="l01462"></a>01462             <a class="code" href="NA__aodv__socket_8cc.html#a40fde4bce5dbf653ef027116bcca0e7b">aodv_socket_send</a>((<a class="code" href="structAODV__msg.html">AODV_msg</a> *) rerr, rerr_dest,<a class="code" href="NA__aodv__rerr_8h.html#a1defe1de303abc4adadc9d0e0fb02720">RERR_CALC_SIZE</a>(rerr),
<a name="l01463"></a>01463                              1, &amp;<a class="code" href="NA__defs__aodv_8h.html#a3ec95f4497670c4d0d407cbf59b5f0a5">DEV_IFINDEX</a>(NS_IFINDEX));
<a name="l01464"></a>01464         }
<a name="l01465"></a>01465         <a class="code" href="NA__list_8cc.html#a95fe3a213ff2c475c79bd705a56a22cc">list_detach</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a9766df03900778ed6369aad09aeb7d43">l</a>);
<a name="l01466"></a>01466         <a class="code" href="NA__routing__table_8cc.html#a01a24c260d1ec566bcae0dc82d3867cf">precursor_list_destroy</a>(fwd_rt);
<a name="l01467"></a>01467         <span class="keywordflow">if</span> (fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#ad47ac60ff0cfac53148a07bc32fc7585">VALID</a> || fwd_rt-&gt;<a class="code" href="structrt__table.html#a5244f2f5c228579ca6f0797a1f45eb68">state</a> == <a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>)
<a name="l01468"></a>01468             <a class="code" href="NA__routing__table_8h.html#a56f12e70a7c6b6382f18390882a4efa3">rt_tbl</a>.<a class="code" href="structrouting__table.html#a3c6303b4e2dfb9422d985d3a6200c178">num_active</a>--;
<a name="l01469"></a>01469         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a3c6af9d87e4429f83b6ffff58f860252">rt_timer</a>);
<a name="l01470"></a>01470         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a56aadfd52f29b6ca3bece47474dd4ca8">hello_timer</a>);
<a name="l01471"></a>01471         <a class="code" href="NA__timer__queue__aodv_8cc.html#aea7509bb49b915acbf3377bc3523680c">timer_remove</a>(&amp;fwd_rt-&gt;<a class="code" href="structrt__table.html#a4b5c6baab186ae8733b48cf2d5172852">ack_timer</a>);
<a name="l01472"></a>01472         <a class="code" href="NA__routing__table_8h.html#a56f12e70a7c6b6382f18390882a4efa3">rt_tbl</a>.<a class="code" href="structrouting__table.html#a7125a62fc2021951e4effe615a892fd9">num_entries</a>--;
<a name="l01473"></a>01473         free (fwd_rt);
<a name="l01474"></a>01474     }
<a name="l01475"></a>01475     <span class="keywordflow">else</span>
<a name="l01476"></a>01476         <a class="code" href="NA__debug__aodv_8h.html#a313135eee76ddadcadd30d768c95fcae">DEBUG</a>(LOG_DEBUG, 0, <span class="stringliteral">&quot;No route entry to delete&quot;</span>);
<a name="l01477"></a>01477 
<a name="l01478"></a>01478     <span class="keywordflow">for</span> (index = 0; index &lt;getNumInterfaces(); index++)
<a name="l01479"></a>01479     {
<a name="l01480"></a>01480         <span class="keywordflow">if</span> (strcmp(ifaceName, getInterfaceEntry(index)-&gt;<a class="code" href="utilidades_8cc.html#af5b5c4787ffe48b5c4fc01aea42cd1c4">getName</a>())==0) <span class="keywordflow">break</span>;
<a name="l01481"></a>01481     }
<a name="l01482"></a>01482     <span class="keywordflow">if</span> (index&gt;=getNumInterfaces())
<a name="l01483"></a>01483         status = <span class="keyword">false</span>;
<a name="l01484"></a>01484 
<a name="l01485"></a>01485     <a class="code" href="NA__aodv__uu__omnet_8cc.html#a02b4c17f3b5f244a29321bf62e72fe66">ManetRoutingBase::setRoute</a>(dest,add,index,hops,mask);
<a name="l01486"></a>01486 
<a name="l01487"></a>01487     <span class="keywordflow">if</span> (!delEntry &amp;&amp; index&lt;getNumInterfaces())
<a name="l01488"></a>01488     {
<a name="l01489"></a>01489         fwd_rt = <a class="code" href="NA__routing__table_8cc.html#ac1648cf2755eba3487d843755d0bd653">modifyAODVTables</a>(destAddr,nextAddr,hops,(uint32_t) SIMTIME_DBL(simTime()), 0xFFFF,<a class="code" href="NA__routing__table_8h.html#a6f8693020afbdaeccfa0eaecffe05dd6">IMMORTAL</a>,0, index);
<a name="l01490"></a>01490         status = (fwd_rt!=NULL);
<a name="l01491"></a>01491     }
<a name="l01492"></a>01492 
<a name="l01493"></a>01493 
<a name="l01494"></a>01494     <span class="keywordflow">return</span> status;
<a name="l01495"></a>01495 }
<a name="l01496"></a>01496 <span class="preprocessor">#endif</span>
<a name="l01497"></a>01497 <span class="preprocessor"></span>
<a name="l01498"></a>01498 
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="NA__aodv__uu__omnet_8cc.html">NA_aodv_uu_omnet.cc</a>      </li>

    <li class="footer">Generated on Fri Oct 18 2013 20:34:56 for NETWORK ATTACKS FRAMEWORK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
